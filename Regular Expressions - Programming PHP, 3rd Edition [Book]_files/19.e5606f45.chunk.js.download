(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{"3y+j":function(e,t,n){},"6wvX":function(e,t,n){"use strict";var a=n("uDfI"),r=n("0lfv");t.a=function useIsMobile(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Object(a.c)(function(t){return Object(r.i)(t.session.context.userAgent,e)})}},"7fJ7":function(e,t,n){"use strict";n.r(t);var a=n("mj2O"),r=n.n(a),c=n("7SM1"),o=n("s8DI"),i=n("QtlZ"),s=n("Wjfv"),u=n("7oto"),l=function UseRemoveActiveCampaign(){Object(u.c)({topic:"CONDUCTOR:remove-active-campaign",handler:function handler(e){i.a.dispatch(Object(s.a)())}})},d=n("nfbA"),f=n("mfas"),p=function UseStateSnapShot(){return Object(u.c)({topic:"CONDUCTOR:request-state-from-controller",handler:function handler(e){var t=e.data,n=i.a.getState();Object(u.a)({topic:"".concat(t.name,":state-snap-shot"),message:{state:Object(d.a)(Object(d.a)({},Object(f.a)(["session"],n)),{},{session:Object(f.a)(["sockets"],n.session)})}})}}),i.a},b=n("My8U"),h=n("nQD+"),v=n("ab+K"),g=n("7oh4"),O=n("nedb"),j=n("LVcX"),m=n("ERkP"),k=n.n(m),_=function useIsBotMessage(e){return Object(m.useMemo)(function(){return Object(j.a)(!1,["attributes","isBot"],e)},[e])},y=n("rAhV"),w=n("58kB"),C=n("da4L"),E=n("i9gz"),x=n("DboL"),I=n("uDfI"),S=function useUnreadMessagesForActiveConversation(){var e=Object(I.c)(function(e){return e.conversations}).activeConversation,t=Object(I.c)(function(t){return Object(j.a)({},["conversations","messages",e],t)}),n=Object(I.c)(function(t){return Object(j.a)([],["conversations","unreadAgentMessages",e],t)});return Object(m.useMemo)(function(){if(Object(E.a)(t))return[];var e=Object(C.k)(Object(x.a)(t));return e.filter(function(e){return function messageHasBody(e){return!!e.body&&!!e.body.length}(e)&&function messageIsNotRatingPrompt(e){return!Object(C.e)(e,"ratingPrompt")}(e)&&function messageIsUnread(e){return n.includes(e.id)}(e)})},[t,n])},T=n("LwEI"),A=n("SsZN"),M=n("vjCh"),R=n("X9/c"),P=n("g6eD"),N=n("RhEL"),D=n("oPI6"),L=n("y0on"),U=(n("pUpc"),function MessagePreview(){var e=Object(m.useRef)(null),t=Object(I.b)(),n=Object(m.useState)(null),a=Object(o.a)(n,2),r=a[0],c=a[1],i=Object(I.c)(function(e){return e.conversations}).activeConversation,u=S(),l=Object(O.a)(),d=Object(I.c)(function(e){return e.view.chatOpen}),f=Object(T.a)(),p=Object(w.a)(r?r.authorId:null),b=Object(m.useMemo)(function(){return!(!r||!r.body||d)},[r,d]),x=Object(y.a)().markAsRead;Object(m.useEffect)(function setLatestMessageFromConvo(){if(Object(E.a)(u))c(null);else{var e=u.pop()||{};r&&Object(N.a)(e.id,r.id)||c(Object(C.n)(e,100))}},[u]),Object(m.useLayoutEffect)(function updateFrameSize(){if(r){var t=e.current?e.current.clientWidth:22,n=e.current?e.current.clientHeight:22,a=b?t+g.b+40:g.b,c=b&&n+36>g.a?n+36:g.a;Object(R.c)(c),Object(R.d)(a)}},[e,r,b,R.b]);var U=_(r);if(!b)return null;var B=Object(C.c)(r),V=Object(L.a)(p.recipient.name,B);return k.a.createElement("div",{className:"drift-widget-message-preview-wrapper",key:"".concat(r.id,"-preview-box")},k.a.createElement(D.b,{message:V,"aria-live":"polite",clearOnUnmount:!0}),k.a.createElement("div",{className:"drift-widget-message-preview drift-widget-message-preview--align-".concat(f)},k.a.createElement(v.a,{onClick:function dismiss(){if(r&&(x(i),c({}),Object(R.b)(),U)){var e=Object(j.a)(null,["attributes","playbookId"],l);Object(A.p)(r),Object(M.g)(l.id,e),t(Object(s.a)())}}}),k.a.createElement(h.a,{onClick:function openChat(){if(Object(R.b)(),x(i),U){var e=Object(j.a)(null,["attributes","playbookId"],l);Object(A.o)(r),Object(M.g)(l.id,e)}t(Object(P.a)({chatOpen:!0}))},className:"drift-widget-message-preview-text drift-widget-message-preview-text--align-".concat(f),"aria-label":"".concat(V?V+" - ":"","Click to open chat")},k.a.createElement("p",{ref:e},B))))}),B=n("O94r"),V=n.n(B),F=n("+Kbs"),$=n("yEsl"),H=n("hSLT"),G=n("6wvX"),W=n("tLIi"),q=n("o3t1"),J=n("lE29"),z=function useThemeIcon(){var e=Object(I.c)(function(e){return e.embed.configuration}).theme,t=e.iconStyle,n=e.iconUrl,a=e.foregroundColor,r={SOLID1:k.a.createElement(F.h,{fill:"#".concat(a)}),SOLID2:k.a.createElement(F.g,{fill:"#".concat(a)}),OUTLINE1:k.a.createElement(F.e,{fill:"#".concat(a)}),OUTLINE2:k.a.createElement(F.f,{fill:"#".concat(a)}),BOLT:F.c};return{customIcon:n?{backgroundImage:"url(".concat(n,")"),backgroundSize:"cover",backgroundRepeat:"no-repeat"}:{},hasCustomIcon:!!n,Icon:r[t]||null}},K=n("8saY"),Y=function useWidgetIconShape(){return Object(I.c)(function(e){return e.embed.configuration.theme.widgetIconShape})||K.b.SQUARE},Q=n("0B8E"),Z=n("MFhO"),X=function(){var e=Object(c.a)(r.a.mark(function _callee(){var e,t;return r.a.wrap(function _callee$(n){for(;;)switch(n.prev=n.next){case 0:if(e=Object(j.a)(!1,["embed","configuration","theme","soundNotificationEnabled"],i.a.getState()),t=i.a.getState().view.chatOpen,!e){n.next=5;break}return n.next=5,Object(u.a)({topic:"play-host-notification",message:{chatOpen:t}});case 5:case"end":return n.stop()}},_callee)}));return function playSoundNotification(){return e.apply(this,arguments)}}(),ee=n("rTkt"),te=(n("3y+j"),function WidgetIcon(){var e=Object(q.a)(),t=e.hoverProps,n=e.isHovered,a=Object(m.useState)(!1),r=Object(o.a)(a,2),c=r[0],i=r[1],s=Object(I.b)(),l=Object(I.c)(function(e){return e.view.chatOpen}),f=Object(I.c)(function(e){return e.session.gdpr}),p=Object(I.c)(function(e){return!!e.conversations.activeConversation}),b=Object(T.a)(),h=Object(O.a)(),v=Object(I.c)(function(e){return Object(j.a)(!1,["embed","configuration","theme"],e)}).unreadBadgeEnabled,g=Object(I.c)(function(e){return e.conversations}).activeConversation,w=S(),C=Object(W.a)(),E=_(C),x=Object(J.a)(),N=x.backgroundStyles,D=x.widgetSecondaryColor,L=Object(m.useMemo)(function(){return n?Object(ee.c)(N.background,-35):N.background},[n,N]),U=z(),B=U.Icon,K=U.customIcon,te=U.hasCustomIcon,ne=Object(H.a)(),ae=ne.senderId,re=ne.type,ce=Object(y.a)().markAsRead,oe=ae||Object(j.a)(void 0,["authorId"],C),ie=w?Object(Q.a)(w).length:0,se=re===Z.a.SLIDER,ue=se&&ae,le=oe&&w.length>0,de=Object(G.a)(),fe=Y();Object(m.useEffect)(function(){c||(Object(R.e)(),i(!0))},[c]),Object(m.useEffect)(function(){Object(u.a)({topic:"toggle-widget-controller",message:{open:l,hasActiveConversation:p&&f.hasConsent}})},[l,f,p]),Object(m.useEffect)(function(){w&&w.length>0&&X()},[w]);var pe=Object(m.useMemo)(function(){return le&&!l?{}:te?l?{background:"".concat(L)}:n?Object(d.a)({opacity:.65},K):K:{background:"".concat(L)}},[K,le,l,L,te,n]),be=Object(m.useMemo)(function(){return l?"Close chat":v&&ie>0?"".concat("Open chat"," - Unread messages: ").concat(ie):"Open chat"},[l,v,ie]);return k.a.createElement("button",Object.assign({className:V()("drift-widget-controller drift-widget-controller--align-".concat(b),[fe],{"drift-widget-controller--closed":!de&&l,"drift-widget-controller--custom-icon":te,"drift-widget-controller--avatar":le}),onClick:function onToggleChat(){if(!l&&(ce(g),ie>0&&E)){var e=Object(j.a)(null,["attributes","playbookId"],h);Object(M.g)(h.id,e),Object(A.o)(C)}!function toggle(e){se?Object(u.a)({topic:"slider:showDetails",message:{}}):s(Object(P.a)({chatOpen:e})),e&&Object(u.a)({topic:"reset-controller-size"})}(!l)},style:pe},t,{"aria-label":be}),k.a.createElement("div",{className:V()("drift-widget-controller-icon",[fe])},k.a.createElement("div",{className:"drift-controller-icon--active"},!te&&!le&&(ue?k.a.createElement(F.l,{fill:D}):B),le&&k.a.createElement($.a,{className:V()([fe],"drift-controller-icon--avatar"),avatarClassName:V()([fe],"drift-controller-icon--avatar-avatar"),id:oe})),k.a.createElement("div",{className:"drift-controller-icon--close",style:{backgroundColor:D}})),v&&ie>0&&k.a.createElement("div",{className:"drift-controller-icon-unread"},Math.min(ie,99)))}),ne=function ControllerLayout(){var e=Object(I.c)(function(e){return!!e.campaigns.activeCampaign.id}),t=Object(I.c)(function(e){return e.view.matchedTargeting}),n=Object(I.c)(function(e){return e.conversations.hasForcedConversation}),a=S(),r=e||t||n,c=Object(m.useMemo)(function(){return!!a.length},[a]);return k.a.createElement("main",{role:"main","aria-label":"Chat widget"},k.a.createElement(D.a,null,c&&k.a.createElement(U,null),r&&k.a.createElement(te,null)))},ae=n("WwEg"),re=n("OE2q"),ce=n("LqZ+"),oe=n("2PAb"),ie=n("K7i0"),se=n("Cpup"),ue=function receiveEmbedConfiguration(e){return Object(se.a)({type:"RECEIVE_EMBED_CONFIGURATION",payload:e})},le=n("SFoa"),de=n("PCkZ"),fe=n("TDUE"),pe=n("qwiD"),be=n("SHZQ"),he=function setShouldSkipCampaigns(e){return Object(se.a)({type:"SET_SHOULD_SKIP_CAMPAIGNS",payload:e})},ve=function setShouldForceShowWidget(e){return Object(se.a)({type:"SET_SHOULD_FORCE_SHOW_WIDGET",payload:e})},ge=function updateOnlineStatus(e){return Object(se.a)({type:"UPDATE_ONLINE_STATUS",payload:e})},Oe=n("0lfv"),je=n("rAc1"),me=n("l6A5"),ke=function memoizeUntil(e,t){var n=!1;return Object(me.a)(function timeBased(){return setTimeout(function(){return n=!0},t),n&&setTimeout(function(){return n=!1},0),Object(je.a)(n).toString()},e)}(Object(c.a)(r.a.mark(function _callee(){var e,t,n;return r.a.wrap(function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return e=i.a.getState().embed.id,a.next=3,Object(be.c)(e);case 3:return t=a.sent,n=t.data,a.abrupt("return",n);case 6:case"end":return a.stop()}},_callee)})),5e3),_e=function(){var e=Object(c.a)(r.a.mark(function _callee2(){var e,t;return r.a.wrap(function _callee2$(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,ke();case 3:return e=n.sent,t=Object(j.a)(!1,["driftOnline"],e),i.a.dispatch(ge(t)),n.abrupt("return",t);case 9:return n.prev=9,n.t0=n.catch(0),Object(Oe.e)("Failed to fetch online status -  ".concat(n.t0.message),n.t0),n.abrupt("return",!1);case 13:case"end":return n.stop()}},_callee2,null,[[0,9]])}));return function getIsOnline(){return e.apply(this,arguments)}}(),ye=function(){var e=Object(c.a)(r.a.mark(function _callee3(){var e,t,n,a;return r.a.wrap(function _callee3$(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,ke();case 3:return e=r.sent,t=e.availableTeams||[],n=Object(j.a)([],["configuration","teams"],i.a.getState().embed),a={},n.forEach(function(e){var n=t.includes(e.id);a[e.id]={isOnline:n}}),r.abrupt("return",a);case 11:return r.prev=11,r.t0=r.catch(0),Object(Oe.e)("Failed to fetch team availability",r.t0),r.abrupt("return",{});case 15:case"end":return r.stop()}},_callee3,null,[[0,11]])}));return function getTeamAvailability(){return e.apply(this,arguments)}}(),we=n("xXFf"),Ce=n("y0Ar"),Ee=n("NFvl"),xe=n("vYqp"),Ie=n("hm8b"),Se=n("vTYT"),Te=n("PjZB"),Ae=n("EQxi"),Me=n("9ttK"),Re=["EMAIL_CAPTURE","ANNOUNCEMENT_ONE_TIME"],Pe=/\{\{[\s\w.'"\\|()]+\}\}/g,Ne=function generateCampaignFrame(e,t,n){return Object(u.a)({topic:"generate-new-frame",message:{name:e,height:t,width:n,path:"core/".concat(e),alignment:Object(le.f)()}})},De={SLIDER:function SLIDER(){return Ne(Se.b.SLIDER,"100%","400px")},TAKEOVER:function TAKEOVER(){return Ne(Se.b.TAKEOVER,"100%","100%")},WELCOME_MESSAGE:function WELCOME_MESSAGE(){return i.a.dispatch(Object(P.a)({chatOpen:!0}))}},Le=function dispatchRenderForEmailCaptureCampaign(){return Ne(Se.b.EMAIL_CAPTURE,"0px","400px")},Ue=function dispatchRenderForAnnouncementCampaign(e){var t=De[e];t&&t()},Be=function(){var e=Object(c.a)(r.a.mark(function _callee(e){var t,n,a,c,o,s,u;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:if(t=Object(Me.a)(e,["message"],""),!(null!==t.match(Pe))){r.next=10;break}return n=i.a.getState(),a=n.session,c=Object(Ee.a)(["endUser","id"],a),r.next=7,Object(we.c)({campaignId:e.id,senderId:Object(Me.a)(e,["senderId"]),endUserId:c});case 7:o=r.sent,s=o.data,t=s.message;case 10:return u=Object(Ae.b)(t),r.abrupt("return",u);case 12:case"end":return r.stop()}},_callee)}));return function resolveAnnouncementMessage(t){return e.apply(this,arguments)}}(),Ve=function(){var e=Object(c.a)(r.a.mark(function _callee2(e,t){var n,a,c,o;return r.a.wrap(function _callee2$(r){for(;;)switch(r.prev=r.next){case 0:if((n=Object(Me.b)(e))&&Re.includes(n.type)){r.next=3;break}return r.abrupt("return");case 3:return a=Object(Me.a)(n,["displayType"]),c=Object(Me.a)(n,["playbookId"]),r.next=7,Be(n);case 7:o=r.sent,Object(M.a)(n,o),Object(Ce.a)({playbookId:c,isVirtual:!0,isDelayed:t}),n.type===Z.a.EMAIL_CAPTURE?Le():Ue(a);case 11:case"end":return r.stop()}},_callee2)}));return function renderAnnouncementCampaign(t,n){return e.apply(this,arguments)}}(),Fe=function(){var e=Object(c.a)(r.a.mark(function _callee3(e,t,n,a,c){var o,s,u,l,f,p;return r.a.wrap(function _callee3$(r){for(;;)switch(r.prev=r.next){case 0:return o=Object(le.c)(),r.prev=1,s=Object(Me.b)(e),u=Object(Ee.a)(["attributes","interactionId"],s),r.next=6,Object(we.b)({playbookId:t,campaignId:e,interactionId:u,inboxId:s.inboxId,locale:o});case 6:if(204!==(l=r.sent).status){r.next=10;break}return Object(we.a)(e,n,a),r.abrupt("return");case 10:f=l.data,Object(M.a)(s),p=f.messages.map(function(e){return Object(d.a)(Object(d.a)({},e),{},{contentType:Te.c.CHAT})}),Object(Ce.a)({playbookId:t,isVirtual:!0,isDelayed:c}),Object(A.q)(Object(d.a)(Object(d.a)({},p[0]),{},{id:null,conversationId:null})),i.a.dispatch(Object(ie.k)({campaignId:e,messages:p,resumeFlowContext:Object(xe.a)(Ie.a,f.resumeFlowContext)})),r.next=21;break;case 18:r.prev=18,r.t0=r.catch(1),Object(we.a)(e,n,a);case 21:case"end":return r.stop()}},_callee3,null,[[1,18]])}));return function renderBotCampaign(t,n,a,r,c){return e.apply(this,arguments)}}(),$e=n("Maj3"),He=n("K0Zh"),Ge=n("gG69"),We=n("Jstd"),qe=n("4Zd6"),Je=function isAnyOf(e,t){return Object(We.a)(function(e){return t===e})(e)},ze=function notIsAnyOf(e,t){return!Je(e,t)},Ke=function is(e,t){return e===t},Ye=function notIs(e,t){return e!==t},Qe=function lessThan(e,t){return t<e},Ze=function greaterThan(e,t){return t>e},Xe=function isBetween(e,t){return!!e.min&&!!e.max&&t>=e.min&&t<=e.max},et=function includesAnyOf(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Object(We.a)(function(e){return-1!==t.indexOf(e)})(e)},tt=function notIncludesAnyOf(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Object(qe.a)(function(e){return-1===t.indexOf(e)})(e)},nt={device:{async:!1,selector:function selector(e){return function resolveDeviceType(e){var t=e.toLowerCase();return t.match(/(mobi|phone|ipod|blackberry|docomo|iphone|android)/i)?"mobile":t.match(/(ipad|kindle)/i)?"tablet":"desktop"}(Object(j.a)("",["_window","userAgent"])(e))},operands:{isAnyOf:Je,notIsAnyOf:ze}},siteVisits:{async:!1,selector:function selector(e){return Object(j.a)(0,["visitInformation","total"])(e)},operands:{is:Ke,notIs:Ye,lessThan:Qe,greaterThan:Ze,isBetween:Xe}},daysSinceLastVisit:{async:!1,selector:function selector(e){return Object(j.a)(0,["visitInformation","daysSinceLastVisit"])(e)},operands:{is:Ke,notIs:Ye,lessThan:Qe,greaterThan:Ze,isBetween:Xe}},referrer:{async:!1,transformValueFn:function transformValueFn(e){return e.map(function(e){return Object(Ae.c)(e)})},selector:function selector(e){return Object(Ae.c)(Object(j.a)("",["referrer"])(e))},operands:{is:Ke,notIs:Ye,isAnyOf:Je,notIsAnyOf:ze,includesAnyOf:et,notIncludesAnyOf:tt}},cookie:{async:!1,selector:function selector(e){return Object.entries(Object(j.a)({},["cookies"])(e)).map(function(e){return e.join("=")})},operands:{is:Ke,notIs:Ye,isAnyOf:Je,notIsAnyOf:ze,includesAnyOf:et,notIncludesAnyOf:tt}},scrollPct:{async:!0,eventType:"scroll",selector:function selector(e){var t=Object(j.a)(0,["_window","scrollY"])(e);return(Object(j.a)(0,["_window","innerHeight"])(e)+t)/Object(j.a)(0,["scrollableHeight"])(e)*100},operands:{lessThan:Qe,greaterThan:Ze,isBetween:Xe}},secondsOnPage:{async:!0,timer:!0,eventType:"timer",selector:function selector(e){var t=Object(j.a)(0,["_window","drift_page_view_started"])(e);return Math.floor((new Date).getTime()/1e3)-t},operands:{lessThan:Qe,greaterThan:Ze}},secondsOnSite:{async:!0,timer:!0,eventType:"timer",selector:function selector(e){var t=Object(j.a)(0,["_window","drift_session_started"])(e);return Math.floor((new Date).getTime()/1e3)-t},operands:{lessThan:Qe,greaterThan:Ze}},exitIntent:{async:!1,selector:function selector(e){return!1},operands:{is:Ke}},outboundSession:{async:!1,selector:function selector(e){return Object(j.a)(!1,["session","isOutbound"])(e)},operands:{is:Ke,notIs:Ye}},autoAssigneeId:{async:!1,selector:function selector(e){return Object(j.a)("",["embed","configuration","autoAssigneeId"])(e)},operands:{is:Ke,notIs:Ye,isAnyOf:Je,notIsAnyOf:ze}},inboxId:{async:!1,selector:function selector(e){return Object(j.a)("",["embed","configuration","inboxId"])(e)},operands:{isAnyOf:Je,notIsAnyOf:ze}}},at=function isUnsupportedCondition(e){return!nt[e.field]},rt=function(){var e=Object(c.a)(r.a.mark(function _callee(e,t){var n,a,c,o,i,s;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:if(!at(e)){r.next=2;break}return r.abrupt("return",Promise.resolve({conditionEvaluation:!1,conditionEvalDetail:{evaluatedCondition:e,matched:!1,status:"PENDING"}}));case 2:return n=nt[e.field],a=n.operands[e.operator],c=n.transformValueFn?n.transformValueFn(e.value):e.value,r.next=7,n.selector(t,e);case 7:return o=r.sent,i=a(c,o),s={evaluatedCondition:e,matched:i,actualValue:o,status:n.async?i?"EVALUATED":"PENDING":"EVALUATED"},r.abrupt("return",Promise.resolve({conditionEvaluation:i,conditionEvalDetail:s}));case 11:case"end":return r.stop()}},_callee)}));return function evaluateSingleCondition(t,n){return e.apply(this,arguments)}}(),ct=function conditionEvaluator(e){return function(t){return rt(e,t)}},ot=function(){var e=Object(c.a)(r.a.mark(function _callee3(e){var t,n,a,o,i,s,u,l,d,f,p,b,h,v,g;return r.a.wrap(function _callee3$(O){for(;;)switch(O.prev=O.next){case 0:t=e.context,n=e.conditions,a=!1,o=[],i=[],s=function(){var e=Object(c.a)(r.a.mark(function _callee2(e){var n,a,c,i,s,u,l,d,f,p,b,h,v,g,O;return r.a.wrap(function _callee2$(j){for(;;)switch(j.prev=j.next){case 0:n=!0,a=[],j.t0=r.a.keys(e);case 3:if((j.t1=j.t0()).done){j.next=23;break}return c=j.t1.value,i=e[c],j.next=8,rt(i,t);case 8:if(s=j.sent,u=s.conditionEvalDetail,l=s.conditionEvaluation,a.push(u),l||at(u.evaluatedCondition)){j.next=21;break}if(d=nt[i.field],f=d.async,p=void 0!==f&&f,b=d.eventType,h=void 0===b?null:b,v=d.timer,g=void 0!==v&&v,O=d.selector,n=!1,!p){j.next=19;break}o.push({conditionDefinition:i,selector:O,eventType:h,timer:g,type:i.field,evaluator:ct(i)}),j.next=21;break;case 19:return o=[],j.abrupt("break",23);case 21:j.next=3;break;case 23:return j.abrupt("return",Promise.resolve({fullGroupMatch:n,groupEval:{targetingConditions:a,status:o.length?"PENDING":"EVALUATED"}}));case 24:case"end":return j.stop()}},_callee2)}));return function evaluateConditions(t){return e.apply(this,arguments)}}(),u=!0,l=!1,d=void 0,O.prev=8,f=n[Symbol.iterator]();case 10:if(u=(p=f.next()).done){O.next=25;break}return b=p.value,O.next=14,s(b);case 14:if(h=O.sent,v=h.fullGroupMatch,g=h.groupEval,i.push(g),!v){O.next=22;break}return a=!0,o=[],O.abrupt("break",25);case 22:u=!0,O.next=10;break;case 25:O.next=31;break;case 27:O.prev=27,O.t0=O.catch(8),l=!0,d=O.t0;case 31:O.prev=31,O.prev=32,u||null==f.return||f.return();case 34:if(O.prev=34,!l){O.next=37;break}throw d;case 37:return O.finish(34);case 38:return O.finish(31);case 39:return O.abrupt("return",Promise.resolve({matched:a,asyncConditionListeners:o,evalLog:i}));case 40:case"end":return O.stop()}},_callee3,null,[[8,27,31,39],[32,,34,38]])}));return function evaluateTargetingConditions(t){return e.apply(this,arguments)}}(),it=n("t8ds"),st=function(){var e=Object(c.a)(r.a.mark(function _callee(){var e,t,n,a,c,o,s,l,d,f,p,b,h,v,g,O,j;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return e=i.a.getState(),t=e.embed,n=e.session,r.next=3,Object(u.a)({topic:"get-host-window"});case 3:return a=r.sent,c=a.data,o=void 0===c?{}:c,r.next=8,Object(u.a)({topic:"get-host-cookies"});case 8:return s=r.sent,l=s.data,d=void 0===l?{}:l,r.next=13,Object(u.a)({topic:"get-host-referrer"});case 13:return f=r.sent,p=f.data,b=void 0===p?"":p,r.next=18,Object(u.a)({topic:"get-scrollable-height"});case 18:return h=r.sent,v=h.data,r.next=22,it.a.get("visitCounts");case 22:return g=r.sent,O=g.data,j={_window:o,visitInformation:void 0===O?{}:O,cookies:d,geo:n.geo,embed:t,referrer:b,scrollableHeight:v},r.abrupt("return",Promise.resolve(j));case 27:case"end":return r.stop()}},_callee)}));return function generateTargetingContext(){return e.apply(this,arguments)}}(),ut=function(){var e=Object(c.a)(r.a.mark(function _callee2(){var e,t,n,a,c,o,s,u=arguments;return r.a.wrap(function _callee2$(r){for(;;)switch(r.prev=r.next){case 0:return e=u.length>0&&void 0!==u[0]?u[0]:[],t=e.map(function(e){return{key:"".concat(e.outputKey,"-").concat(e.label),priority:e.priority,conditionSets:e.conditionSets}}),n=i.a.getState(),a=n.embed,c=yt(),r.prev=4,r.next=7,Object(be.b)(a.id,{clientSideContext:c,conditionGroups:t});case 7:return o=r.sent,s=o.data,r.next=11,vt(s);case 11:return r.abrupt("return",r.sent);case 14:r.prev=14,r.t0=r.catch(4),Object(Oe.k)({data:["Failed to evaluate conditional skill",r.t0]});case 17:case"end":return r.stop()}},_callee2,null,[[4,14]])}));return function evaluateTargetingForConditionalSets(){return e.apply(this,arguments)}}(),lt=["secondsOnSite","secondsOnPage","scrollPct","exitIntent"],dt=function _addEvaluationResultToAuditLog(e){var t=e.auditLog,n=e.isServerGenerated,a=void 0===n||n,r=e.evaluationResults,c=e.didMatch,o=e.campaignId,i=e.priority,s=e.status,u=void 0===s?Ge.b.EVALUATED:s;if(t.conditionGroups){var l=a?pt(r):r;t.conditionGroups.push({status:u,matched:c,conditionSets:l,key:o,priority:i})}},ft=function(){var e=Object(c.a)(r.a.mark(function _callee(e){var t,n,a,c;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return t=e.filter(function(e){return!e.allConditionsFullyEvaluated&&e.allConditionsPotentiallyMatched}),n=t.map(function(e){return e.evaluatedTargetConditionSet}),a=n.map(function(e){return e.filter(function(e){return!e.fullyEvaluated}).map(function(e){return e.evaluatedTargetCondition}).map(function(e){return e.condition})}),r.next=5,st();case 5:return c=r.sent,r.next=8,ot({conditions:a,context:c});case 8:return r.abrupt("return",r.sent);case 9:case"end":return r.stop()}},_callee)}));return function _evaluateTargetingForEvaluationResults(t){return e.apply(this,arguments)}}(),pt=function _generateAuditLogForServerEvaluationResults(e){return Object($e.a)(function(e){return e.evaluatedTargetConditionSet},e).map(function(e){return ht(e)})},bt=function(){var e=Object(c.a)(r.a.mark(function _callee3(e){var t,n,a,o,i,s,l=arguments;return r.a.wrap(function _callee3$(d){for(;;)switch(d.prev=d.next){case 0:if(t=l.length>1&&void 0!==l[1]?l[1]:function(){},n=Object(Oe.n)(),a=function(){var a=Object(c.a)(r.a.mark(function _callee2(){var a;return r.a.wrap(function _callee2$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,st();case 2:return a=r.sent,r.next=5,e.evaluator(a);case 5:if(r.sent.conditionEvaluation){r.next=8;break}return r.abrupt("return");case 8:e.eventType&&(Object(u.a)({topic:"remove-host-event-listener",message:{id:n,event:e.eventType}}),t());case 9:case"end":return r.stop()}},_callee2)}));return function asyncConditionHandler(){return a.apply(this,arguments)}}(),!e.timer){d.next=12;break}return d.next=6,st();case 6:o=d.sent,i=e.conditionDefinition.value,(s=i-e.selector(o))>0&&setTimeout(a,1e3*s+1e3),d.next=13;break;case 12:Object(u.a)({topic:"add-host-event-listener",message:{id:n,event:e.eventType,handler:a}});case 13:case"end":return d.stop()}},_callee3)}));return function _waitForCondition(t){return e.apply(this,arguments)}}(),ht=function _generateAuditLogResultForConditionSet(e){var t=Object(j.a)(null,["evaluatedTargetCondition","condition"],e),n=Object(j.a)(!1,["evaluatedTargetCondition","matched"],e),a=Object(j.a)(null,["evaluatedTargetCondition","actualValue"],e);return{status:Ge.b.EVALUATED,targetingConditions:[{evaluatedCondition:t,matched:n,actualValue:a,status:Ge.b.EVALUATED,meta:{}}]}},vt=function(){var e=Object(c.a)(r.a.mark(function _callee4(e){var t,n,a,c,o,i,s,u,l,f,p,b,h,v,g;return r.a.wrap(function _callee4$(r){for(;;)switch(r.prev=r.next){case 0:if(e&&e.length){r.next=2;break}return r.abrupt("return",null);case 2:t=Object(d.a)({conditionGroups:[]},_t()),n=!0,a=!1,c=void 0,r.prev=6,o=e[Symbol.iterator]();case 8:if(n=(i=o.next()).done){r.next=32;break}if((s=i.value).status!==Ge.b.EVALUATED||!s.matched){r.next=14;break}t.conditionGroups.push(s),r.next=29;break;case 14:if(s.status!==Ge.b.PENDING){r.next=29;break}return u=s.conditionSets.filter(function(e){return e.status===Ge.b.PENDING}).map(function(e){return e.targetingConditions}),l=u.map(function(e){return e.filter(function(e){return e.status===Ge.b.PENDING}).map(function(e){return e.evaluatedCondition})}),f=u.map(function(e){return e.filter(function(e){return e.status===Ge.b.EVALUATED})}),p=Object(He.a)(f),r.next=21,st();case 21:return b=r.sent,r.next=24,ot({conditions:l,context:b});case 24:h=r.sent,v=h.matched,g=h.evalLog,p.length&&(g[0].targetingConditions=[].concat(Object(ae.a)(g[0].targetingConditions),Object(ae.a)(p))),t.conditionGroups.push({status:Ge.b.EVALUATED,matched:v,conditionSets:g,key:s.key,priority:s.priority});case 29:n=!0,r.next=8;break;case 32:r.next=38;break;case 34:r.prev=34,r.t0=r.catch(6),a=!0,c=r.t0;case 38:r.prev=38,r.prev=39,n||null==o.return||o.return();case 41:if(r.prev=41,!a){r.next=44;break}throw c;case 44:return r.finish(41);case 45:return r.finish(38);case 46:return r.abrupt("return",t);case 47:case"end":return r.stop()}},_callee4,null,[[6,34,38,46],[39,,41,45]])}));return function evaluateConditionalSkillTargetingConditions(t){return e.apply(this,arguments)}}(),gt=function(){var e=Object(c.a)(r.a.mark(function _callee5(e){var t,n,a,c,o,i,s,u,l;return r.a.wrap(function _callee5$(r){for(;;)switch(r.prev=r.next){case 0:if(e&&e.length){r.next=2;break}return r.abrupt("return",[]);case 2:t=[],n=function toMatchedRule(e){return{id:e.ruleId,priority:e.priority}},a=!0,c=!1,o=void 0,r.prev=7,i=e[Symbol.iterator]();case 9:if(a=(s=i.next()).done){r.next=24;break}if((u=s.value).evaluationMatchOutcome!==Ge.a.MATCH){r.next=15;break}t.push(n(u)),r.next=21;break;case 15:if(u.evaluationMatchOutcome!==Ge.a.POTENTIAL_MATCH){r.next=21;break}return r.next=18,ft(u.evaluationResults);case 18:l=r.sent,l.matched&&t.push(n(u));case 21:a=!0,r.next=9;break;case 24:r.next=30;break;case 26:r.prev=26,r.t0=r.catch(7),c=!0,o=r.t0;case 30:r.prev=30,r.prev=31,a||null==i.return||i.return();case 33:if(r.prev=33,!c){r.next=36;break}throw o;case 36:return r.finish(33);case 37:return r.finish(30);case 38:return r.abrupt("return",t);case 39:case"end":return r.stop()}},_callee5,null,[[7,26,30,38],[31,,33,37]])}));return function evaluateRoutingTargetingConditions(t){return e.apply(this,arguments)}}(),Ot=function(){var e=Object(c.a)(r.a.mark(function _callee6(e){var t,n,a,c,o,i,s,u,l,d,f;return r.a.wrap(function _callee6$(r){for(;;)switch(r.prev=r.next){case 0:if(t=e.evaluationMatchOutcome,n=e.evaluationResults,a=void 0===n?[]:n,c=e.onMatched,o=void 0===c?function(){}:c,i=e.onDidNotMatch,s=void 0===i?function(){}:i,u=[],t!==Ge.a.MATCH){r.next=4;break}return r.abrupt("return",o());case 4:if(t!==Ge.a.NO_MATCH){r.next=6;break}return r.abrupt("return",s());case 6:if(t!==Ge.a.POTENTIAL_MATCH){r.next=17;break}return r.next=9,ft(a);case 9:if(l=r.sent,d=l.matched,f=l.asyncConditionListeners,!d){r.next=16;break}return r.abrupt("return",o());case 16:u=[].concat(Object(ae.a)(u),Object(ae.a)(f));case 17:if(u.forEach(function(e){return bt(e,function(){return o()})}),u.length){r.next=20;break}return r.abrupt("return",s());case 20:return r.abrupt("return",s());case 21:case"end":return r.stop()}},_callee6)}));return function evaluateWidgetDisplayTargetingConditions(t){return e.apply(this,arguments)}}(),jt=function(){var e=Object(c.a)(r.a.mark(function _callee7(e){var t,n,a,c,i,s,u,l,d,f,p,b,h,v,g,O,j,m,k,_,y,w,C,E,x,I,S,T,A,M,R;return r.a.wrap(function _callee7$(r){for(;;)switch(r.prev=r.next){case 0:b=function _ref17(e){return Object($e.a)(function(e){return e.evaluatedTargetConditionSet},e.filter(function(e){return e.fullyEvaluatedAndMatched})).filter(function(e){return e.fullyEvaluated}).map(function(e){return e.evaluatedTargetCondition}).filter(function(e){return e.matched}).map(function(e){return e.condition})},p=function _ref16(e){var t=e.filter(function(e){return"EVALUATED"===e.status}).map(function(e){return e.targetingConditions}).filter(function(e){return e.filter(function(e){return e.matched})});return Object($e.a)(function(e){return e.map(function(e){return e.evaluatedCondition})},t)},t=e.conditions,n=void 0===t?[]:t,a=e.onMatched,c=void 0===a?function(){}:a,i=e.onDidNotMatch,s=void 0===i?function(){}:i,u={conditionGroups:[]},l=[],d=function onConditionMatched(e){var t=e.campaignId,n=e.matchedConditions,a=(void 0===n?[]:n).map(function(e){return e.field}).filter(function(e){return lt.includes(e)}).length>0;return c&&c(t,a),Promise.resolve({TAL:u,matched:!0})},f=function onNoConditionMatched(){return s&&s(),Promise.resolve({TAL:u,matched:!1})},h=!0,v=!1,g=void 0,r.prev=10,O=n.entries()[Symbol.iterator]();case 12:if(h=(j=O.next()).done){r.next=47;break}if(m=Object(o.a)(j.value,2),k=m[0],_=m[1],y=_.campaignId,w=_.evaluationMatchOutcome,C=_.evaluationResults,E=void 0===C?[]:C,w!==Ge.a.NO_MATCH){r.next=19;break}dt({evaluationResults:E,auditLog:u,didMatch:!1,campaignId:y,priority:k+1}),r.next=40;break;case 19:if(w!==Ge.a.MATCH){r.next=25;break}return dt({evaluationResults:E,auditLog:u,didMatch:!0,campaignId:y,priority:k+1}),x=b(E),r.abrupt("return",d({campaignId:y,matchedConditions:x}));case 25:if(w!==Ge.a.POTENTIAL_MATCH){r.next=40;break}return r.next=28,ft(E);case 28:if(I=r.sent,S=I.matched,T=I.asyncConditionListeners,A=I.evalLog,dt({auditLog:u,evaluationResults:M=void 0===A?[]:A,didMatch:S,campaignId:y,priority:k+1,isServerGenerated:!1,status:T.length?Ge.b.PENDING:Ge.b.EVALUATED}),!S){r.next=39;break}return R=p(M),r.abrupt("return",d({campaignId:y,matchedConditions:R}));case 39:l=[].concat(Object(ae.a)(l),Object(ae.a)(T));case 40:if(k!==n.length-1){r.next=44;break}if(l.forEach(function(e){return bt(e,function(){return jt({conditions:n,onMatched:c,onDidNotMatch:s})})}),l.length){r.next=44;break}return r.abrupt("return",f());case 44:h=!0,r.next=12;break;case 47:r.next=53;break;case 49:r.prev=49,r.t0=r.catch(10),v=!0,g=r.t0;case 53:r.prev=53,r.prev=54,h||null==O.return||O.return();case 56:if(r.prev=56,!v){r.next=59;break}throw g;case 59:return r.finish(56);case 60:return r.finish(53);case 61:return r.abrupt("return",f());case 62:case"end":return r.stop()}},_callee7,null,[[10,49,53,61],[54,,56,60]])}));return function evaluateCampaignTargetingConditions(t){return e.apply(this,arguments)}}(),mt=function(){var e=Object(c.a)(r.a.mark(function _callee(e){var t,n,a,c,o,s,u;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return t=e.forceShow,n=void 0!==t&&t,a=e.targetingResults,c=void 0===a?{}:a,o=i.a.getState().targeting.skipWidgetTargeting,s=function dispatchWidgetTargetingResult(e,t){i.a.dispatch(Object(P.d)({matchedTargeting:t,matchedHours:e}))},r.next=5,_e();case 5:if(u=r.sent,!o){r.next=9;break}return s(u,!1),r.abrupt("return");case 9:n?s(!0,!0):Ot({evaluationMatchOutcome:c.evaluationMatchOutcome,evaluationResults:c.evaluationResults,onMatched:function onMatched(){return s(u,!0)},onDidNotMatch:function onDidNotMatch(){return s(u,!1)}});case 10:case"end":return r.stop()}},_callee)}));return function evaluateWidgetTargeting(t){return e.apply(this,arguments)}}(),kt=function(){var e=Object(c.a)(r.a.mark(function _callee4(){var e,t,n,a,o,u,l,f,p,b,h,v,g,O,m,k,_,y,w=arguments;return r.a.wrap(function _callee4$(C){for(;;)switch(C.prev=C.next){case 0:if(e=w.length>0&&void 0!==w[0]?w[0]:{},t=e.onDidNotMatch,n=void 0===t?function(){}:t,a=e.unreadCampaignIds,o=void 0===a?[]:a,u=e.evaluatedConditionsResults,l=e.skipCampaignTargeting,f=void 0!==l&&l,p=i.a.getState(),b=p.targeting,h=b.skipCampaigns,v=b.forceShowWidget,g=p.embed.id,O=p.session.campaignRefreshToken,m=function(){var e=Object(c.a)(r.a.mark(function _callee3(e){var t,a,u,l,b,g,m;return r.a.wrap(function _callee3$(k){for(;;)switch(k.prev=k.next){case 0:return k.next=2,gt(e.routingEvaluationResults);case 2:if(t=k.sent,a=f||h,i.a.dispatch(Object(ie.r)(t)),mt({forceShow:v,targetingResults:e.widgetTargetingResults}),!a){k.next=8;break}return k.abrupt("return");case 8:return u=function(){var e=Object(c.a)(r.a.mark(function _callee2(e,t){var n,a;return r.a.wrap(function _callee2$(r){for(;;)switch(r.prev=r.next){case 0:if(!o.includes(e)){r.next=3;break}return r.abrupt("return",Object(M.f)(e));case 3:n=Object(M.d)(e)||{},"BOT"!==n.type?Ve(e,t):(a=Object(j.a)(null,["embed","configuration","team",0,"id"],p),Fe(e,n.attributes.playbookId,a,O,t));case 6:case"end":return r.stop()}},_callee2)}));return function onCampaignMatch(t,n){return e.apply(this,arguments)}}(),k.next=11,jt({conditions:e.campaignTargetingResults,onMatched:u,onDidNotMatch:n});case 11:if(l=k.sent,!(b=l.TAL).conditionGroups.length){k.next=19;break}return k.next=16,Object(be.e)(Object(d.a)(Object(d.a)({},b),_t()));case 16:g=k.sent,m=g.data,i.a.dispatch(Object(s.c)({campaignEvalId:m.targetingEvaluationUUID}));case 19:case"end":return k.stop()}},_callee3)}));return function evaluateTargetingConditions(t){return e.apply(this,arguments)}}(),C.prev=7,!h||!v){C.next=11;break}return mt({forceShow:!0}),C.abrupt("return");case 11:if(u&&!Object(E.a)(u)){C.next=23;break}return k=yt(),C.next=15,Object(be.d)(Object(d.a)(Object(d.a)({embedId:g},k),{},{followingCampaignIds:o,excludedCampaignIds:[]}));case 15:if(_=C.sent,y=_.data){C.next=20;break}return Object(Oe.k)({data:["Empty payload returned for campaign targeting"],type:"warn"}),C.abrupt("return");case 20:m(y),C.next=24;break;case 23:m(u);case 24:C.next=29;break;case 26:C.prev=26,C.t0=C.catch(7),Object(Oe.e)(new Error("Failed to evaluate campaign targeting - ".concat(C.t0.message)),C.t0);case 29:case"end":return C.stop()}},_callee4,null,[[7,26]])}));return function evalTargetingAndEnrollment(){return e.apply(this,arguments)}}(),_t=function getTargetingEvaluationMetadata(){var e=i.a.getState(),t=e.session,n=e.embed;return{targetingContext:{endUserId:Object(j.a)(void 0,["endUser","id"],t),orgId:n.orgId},evaluationOptions:{ignoreUnknowns:!1}}},yt=function getTargetingEvaluationContext(){var e=i.a.getState(),t=e.session,n=t.campaignRefreshToken,a=t.geo,r=t.context,c=t.assignedAgentId,o=Object(E.a)(a)?void 0:a,s=Object(j.a)("",["page","href"],r),u=Object(j.a)({},["conversations","conversations"],e);return{sessionId:n,location:o,pageUrl:s,assignedAgentId:c,hasHadConversations:!Object(E.a)(u),inboxId:Object(j.a)(void 0,["embed","configuration","inboxId"],e)}},wt=n("pqMu"),Ct=function hasGate(e){return Object(j.a)(!1,["embed","configuration","gates",e],i.a.getState())},Et=n("Nlet"),xt=n("VYE+"),It=n("uIJS"),St=n("wQh9"),Tt=function(){function SyncCallbackRunner(){Object(It.a)(this,SyncCallbackRunner),this._running=!1,this._callbacks=[]}return Object(St.a)(SyncCallbackRunner,[{key:"execute",value:function execute(e){this._callbacks.push(e),this.run()}},{key:"run",value:function(){var e=Object(c.a)(r.a.mark(function _callee(){var e,t;return r.a.wrap(function _callee$(n){for(;;)switch(n.prev=n.next){case 0:if(!this._running&&0!==this._callbacks.length){n.next=2;break}return n.abrupt("return");case 2:this._running=!0;case 3:if(!(this._callbacks.length>0)){n.next=11;break}if(e=this._callbacks.shift(),!(t=e())||!t.then){n.next=9;break}return n.next=9,t;case 9:n.next=3;break;case 11:this._running=!1;case 12:case"end":return n.stop()}},_callee,this)}));return function run(){return e.apply(this,arguments)}}()}]),SyncCallbackRunner}(),At=n("4c+F"),Mt=n("3kqR"),Rt=Object.freeze({welcomeMessage:"welcomeMessage",awayMessage:"awayMessage",emailCaptureMessage:"emailCaptureMessage",thankYouMessage:"confirmationMessage"}),Pt=function apiWarning(){for(var e,t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return(e=console).warn.apply(e,["Drift API -"].concat(n))},Nt=function apiError(){for(var e,t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return(e=console).error.apply(e,["Drift API -"].concat(n))},Dt=n("F8vJ"),Lt=function areAttributesValid(e,t,n,a){if(Object(Ie.a)(a))return n;if("function"!==typeof a&&Object(wt.a)(Object,a)){for(var r=0,c=Object.keys(a);r<c.length;r++){var o=c[r],i=a[o];if(!Object(wt.a)(Number,i)&&!Object(wt.a)(String,i)&&!Object(wt.a)(Boolean,i))return Nt("".concat(e,'(...) "').concat(o,'" in ').concat(t," must be number, string, or boolean but instead we got ").concat(typeof i,".")),!1;if("email"===o&&(!Object(wt.a)(String,i)||!Object(Dt.a)(i)))return Nt("".concat(e,"(...) email in ").concat(t," is invalid:"),i),!1}return!0}return!1},Ut=function param(e,t,n){return{name:e,type:t,optional:n}},Bt={config:[Ut("options",Object)],collectFormData:[Ut("data",Lt),Ut("options",Object,!0)],goToConversation:[Ut("Conversation ID",Number)],goToNewConversation:[Ut("Message",String)],identify:[Ut("User ID",String),Ut("attributes",Lt,!0),Ut("options",Object,!0)],off:[Ut("Event name",String),Ut("handler",Function)],on:[Ut("Event name",String),Ut("handler",Function)],page:[Ut("Page name",String,!0)],setUserAttributes:[Ut("attributes",Lt)],setUserJwt:[Ut("User JWT",String)],scheduleMeeting:[Ut("Agent ID",Number),Ut("options",Object,!0)],showAwayMessage:[Ut("Message",String,!0)],showWelcomeMessage:[Ut("Message",String,!0)],startInteraction:[Ut("params",function areStartInteractionParamsValid(e,t,n,a){return Object(Ie.a)(a)&&!n||!Object(wt.a)(Object,a)?(Nt("".concat(e,"({ ... }) must be called with ").concat(t," { interactionId: number, goToConversation: boolean } (goToConversation is optional.)")),!1):a.interactionId&&!Object(Ie.a)(a.interactionId)&&Object(wt.a)(Number,a.interactionId)?!(a.goToConversation&&!Object(wt.a)(Boolean,a.goToConversation))||(Nt("".concat(e,'({ ... }) "goToConversation" parameter should be boolean but we got ').concat(typeof a.goToConversation,".")),!1):(Nt("".concat(e,"({ ... }) requires ").concat(t,' object with numeric "interactionId" but we got ').concat(typeof a.interactionId,".")),!1)})],toggleHoursAndTargeting:[Ut("enabled",Boolean)],track:[Ut("Event name",String),Ut("attributes",Lt,!0)]},Vt=function getTypeName(e){return e===String||Object(wt.a)(String,e)?"string":e===Boolean||Object(wt.a)(Boolean,e)?"boolean":e===Number||Object(wt.a)(Number,e)?"number":e===Object||Object(wt.a)(Object,e)?"object":e===Function||Object(wt.a)(Function,e)?"function":Object(Ie.a)(e)?"null":"unknown"},Ft=function validateMethod(e,t){return Bt[e]?function areArgsValid(e,t,n){var a=t.length,r=n.filter(function(e){return!e.optional}).length;return n.reduce(function(n,c,o){var i=c.name,s=c.type,u=c.optional,l=void 0!==u&&u;if(o>=a)return l||Nt("Invalid ".concat(e,"(...) call! It requires ").concat(r," argument(s) and it's missing ").concat(i," ").concat(Vt(s),".")),n&&l&&a>=r;var d=t[o],f=!1;return l&&Object(Ie.a)(d)?f=!0:s===Function||s===Object||s===String||s===Number||s===Boolean?(f="function"===typeof d?s===Function:Object(wt.a)(s,d))||Nt("Invalid ".concat(e,"(...) call! ").concat(i," (arg ").concat(o,") should be ").concat(Vt(s)," instead of ").concat(Vt(d),".")):f=s(e,i,l,d),n&&f},!0)}(e,t,Bt[e]):(!Object(Ie.a)(t)&&Object(wt.a)(Array,t)&&!!t.length&&Pt("".concat(e,"() should ideally be called without arguments.")),!0)},$t=function track(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{Object(ce.a)(e,t)}catch(n){Object(Oe.k)({data:[n],type:"warn"})}},Ht=function(){var e=Object(c.a)(r.a.mark(function _callee(){return r.a.wrap(function _callee$(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(xt.b)(Object(x.a)(oe.a));case 2:Object(u.a)({topic:"reload-all-frames",message:{}});case 3:case"end":return e.stop()}},_callee)}));return function reset(){return e.apply(this,arguments)}}(),Gt=function openChat(){Kt(),i.a.dispatch(Object(P.a)({chatOpen:!0}))},Wt=function hideChat(){i.a.dispatch(Object(P.a)({chatOpen:!1}))},qt=function(){var e=Object(c.a)(r.a.mark(function _callee2(e){var t,n,a,c;return r.a.wrap(function _callee2$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(Et.b)();case 2:return t=r.sent,i.a.dispatch(Object(pe.h)(t)),n=Object(d.a)({},Object(j.a)({},["page"],t)),e&&"string"===typeof e&&(n.pageName=e),$t("Page",n),r.next=9,Object(u.a)({topic:"reset-campaign-refresh-token"});case 9:a=r.sent,c=a.data,i.a.dispatch(Object(pe.t)(Object(Oe.n)())),i.a.dispatch(Object(pe.s)(c)),kt();case 14:case"end":return r.stop()}},_callee2)}));return function page(t){return e.apply(this,arguments)}}(),Jt=function debouncedAPIMethod(e){return Object(Oe.c)(e,500,!0)}(function(){var e=Object(c.a)(r.a.mark(function _callee3(e){var t,n;return r.a.wrap(function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:if(t=(e||{}).interactionId,n=Object(le.c)(),t||Object(wt.a)(Number,t)){a.next=4;break}return a.abrupt("return");case 4:return i.a.dispatch(Object(ie.p)()),a.next=7,Object(re.a)(t,{isTriggeredFromAPI:!0,locale:n});case 7:case"end":return a.stop()}},_callee3)}));return function _startInteraction(t){return e.apply(this,arguments)}}()),zt=function(){var e=Object(c.a)(r.a.mark(function _callee4(){var e,t,n,a,c,o,s=arguments;return r.a.wrap(function _callee4$(r){for(;;)switch(r.prev=r.next){case 0:return e=s.length>0&&void 0!==s[0]?s[0]:"",t=Object(le.c)(),r.prev=2,r.next=5,Object(re.b)(e,{isTriggeredFromAPI:!0,locale:t});case 5:return n=r.sent,a=n.data,r.next=9,Object(re.f)(a.conversationId);case 9:c=r.sent,o=c.data,i.a.dispatch(Object(ie.g)({conversation:o})),i.a.dispatch(Object(ie.n)({conversationId:a.conversationId})),r.next=17;break;case 15:r.prev=15,r.t0=r.catch(2);case 17:case"end":return r.stop()}},_callee4,null,[[2,15]])}));return function goToNewConversation(){return e.apply(this,arguments)}}(),Kt=function show(){i.a.dispatch(Object(P.d)({matchedTargeting:!0})),Object(R.e)()},Yt=function(){var e=Object(c.a)(r.a.mark(function _callee5(e,t){var n,a,c,o;return r.a.wrap(function _callee5$(r){for(;;)switch(r.prev=r.next){case 0:return n=Object(j.a)(null,["session","endUser","email"],i.a.getState()),a=Object(le.c)(),Gt(),r.prev=3,r.next=6,Object(re.c)(n,e,a,t);case 6:c=r.sent,o=c.data.conversationId,i.a.dispatch(Object(ie.n)({conversationId:o})),Object(A.j)(e),Object(fe.d)(Ge.c.CALENDAR_DROP),r.next=16;break;case 13:r.prev=13,r.t0=r.catch(3),Object(Oe.k)({data:[r.t0],type:"warn"});case 16:case"end":return r.stop()}},_callee5,null,[[3,13]])}));return function scheduleMeeting(t,n){return e.apply(this,arguments)}}(),Qt=function(){var e=Object(c.a)(r.a.mark(function _callee6(e){var t,n,a,c,o=arguments;return r.a.wrap(function _callee6$(r){for(;;)switch(r.prev=r.next){case 0:return t=o.length>1&&void 0!==o[1]?o[1]:{},n=o.length>2&&void 0!==o[2]?o[2]:{},r.prev=2,a=Object(f.a)(["hasProvidedIdentity"],t),r.next=6,Object(de.d)(a,e,n);case 6:t.email&&(c=t.email,i.a.dispatch(Object(pe.j)({endUser:{email:c}}))),r.next=12;break;case 9:r.prev=9,r.t0=r.catch(2),Object(Oe.k)({data:[r.t0],type:"warn"});case 12:case"end":return r.stop()}},_callee6,null,[[2,9]])}));return function identify(t){return e.apply(this,arguments)}}(),Zt=function(){var e=Object(c.a)(r.a.mark(function _callee7(e){return r.a.wrap(function _callee7$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(de.d)(e);case 2:Object(A.s)();case 3:case"end":return t.stop()}},_callee7)}));return function setUserAttributes(t){return e.apply(this,arguments)}}(),Xt=function(){var e=Object(c.a)(r.a.mark(function _callee8(e,t){return r.a.wrap(function _callee8$(n){for(;;)switch(n.prev=n.next){case 0:if(Ct("has_widget_forms")){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,Object(de.d)(e);case 4:if(Object(A.i)(e),t){n.next=7;break}return n.abrupt("return");case 7:if(!t.redirectTo){n.next=10;break}return n.next=10,Object(u.a)({topic:"redirect-to-url",message:{url:t.redirectTo}});case 10:case"end":return n.stop()}},_callee8)}));return function collectFormData(t,n){return e.apply(this,arguments)}}(),en=function(){var e=Object(c.a)(r.a.mark(function _callee9(){return r.a.wrap(function _callee9$(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_e();case 2:return e.t0=e.sent,e.next=5,ye();case 5:return e.t1=e.sent,e.abrupt("return",{isOnline:e.t0,teamAvailability:e.t1,sidebarOpen:!1});case 7:case"end":return e.stop()}},_callee9)}));return function getWidgetReadyPayload(){return e.apply(this,arguments)}}(),tn={identify:Qt,config:function config(e){if(!Object(wt.a)(Object,e))return!1;var t=e.cookieDomain;if(t){var n=Object(xt.f)([t]);n&&i.a.dispatch(Object(pe.i)({cookieDomain:n}))}var a=function configOptionsToEmbedConfiguration(e){var t={theme:{}};if(Object(Ie.a)(e))return t;var n=e.locale,a=e.enableWelcomeMessage,r=e.enableCampaigns,c=e.enableChatTargeting,o=e.backgroundColor,i=e.foregroundColor,s=e.activeColor,u=e.textColor,l=e.widgetBackgroundColor,d=e.autoAssigneeId,f=e.autoAssignee,p=e.inboxId,b=e.enabled,h=e.profileMode,v=e.messages,g=e.cookieDomain,O=e.verticalOffset;return n&&(t.locale=n),Object(Ie.a)(a)||(t.theme.showWelcomeMessage=!!a),Object(Ie.a)(r)||(t.campaignsEnabled=r),!1===c&&(t.theme.audience=K.a.EVERYONE,t.theme.conditions=[]),o&&(t.theme.backgroundColor=o.replace("#","")),i&&(t.theme.foregroundColor=i.replace("#","")),s&&(t.theme.activeColor=s.replace("#","")),u&&(t.theme.textColor=u.replace("#","")),l&&(t.theme.widgetBackgroundColor=l.replace("#","")),Object(Ie.a)(d)||(t.autoAssigneeId=d),Object(Ie.a)(f)||(t.autoAssignee=f),p&&(t.inboxId=p),Object(Ie.a)(O)||(t.verticalOffset=O),Object(Ie.a)(b)||(t.enabled=!!b),Object(Ie.a)(h)||(t.profileMode=!!h),Object(Ie.a)(v)||Object(Mt.a)(function(e,n){v[n]&&(t.theme[e]=v[n])},Rt),Object(Ie.a)(g)||(t.theme.cookieDomains=[g]),t}(e);i.a.dispatch(function receiveEmbedConfigurationOverride(e){return Object(se.a)({type:"RECEIVE_EMBED_CONFIGURATION_OVERRIDE",payload:e})}(a))},track:$t,reset:Ht,debug:function debug(){Pt("drift.debug is not supported in this release.")},show:Kt,ping:function ping(){Pt("drift.ping is not supported in this release.")},page:qt,hide:function hide(){Wt(),Object(R.a)()},off:function off(){},on:function on(){},collectFormData:Xt,goToConversation:function goToConversation(e){i.a.dispatch(Object(ie.n)({conversationId:e})),Gt()},goToConversationList:function goToConversationList(){var e=i.a.getState().conversations;Object(E.a)(e.conversations)||(Gt(),i.a.dispatch(Object(P.b)({conversationHistoryOpen:!0})))},goToNewConversation:zt,hideAwayMessage:function hideAwayMessage(){return Wt()},hideChat:Wt,hideWelcomeMessage:function hideWelcomeMessage(){return Wt()},openChat:Gt,toggleChat:function toggleChat(){Object(j.a)(!1,["view","chatOpen"],i.a.getState())?Wt():Gt()},scheduleMeeting:Yt,setUserAttributes:Zt,showAwayMessage:function showAwayMessage(e){i.a.dispatch(Object(ie.a)()),i.a.dispatch(Object(s.a)()),i.a.dispatch(Object(P.d)({matchedHours:!1,matchedTargeting:!0})),e&&"string"===typeof e&&e.length&&i.a.dispatch(function receiveEmbedAwayMessage(e){return Object(se.a)({type:"RECIEVE_EMBED_AWAY_MESSAGE",payload:e})}({message:e})),Object(R.e)(),i.a.dispatch(Object(P.a)({chatOpen:!0}))},showWelcomeMessage:function showWelcomeMessage(e){i.a.dispatch(Object(ie.a)()),i.a.dispatch(Object(s.a)()),i.a.dispatch(Object(P.d)({matchedHours:!0,matchedTargeting:!0})),e&&"string"===typeof e&&e.length&&i.a.dispatch(function receiveEmbedWelcomeMessage(e){return Object(se.a)({type:"RECEIVE_EMBED_WELCOME_MESSAGE",payload:e})}({message:e})),Object(R.e)(),i.a.dispatch(Object(P.a)({chatOpen:!0}))},showWelcomeOrAwayMessage:function showWelcomeOrAwayMessage(){i.a.dispatch(Object(ie.a)()),Gt()},startInteraction:Jt,startVideoGreeting:function startVideoGreeting(){Pt("drift.startVideoGreeting is not supported in this release.")},evaluateCampaignTargeting:function evaluateCampaignTargeting(){kt()},toggleHoursAndTargeting:function toggleHoursAndTargeting(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];i.a.dispatch(Object(P.d)({matchedHours:e,matchedTargeting:!0}))},waitForUserJwt:function waitForUserJwt(){try{i.a.dispatch(Object(pe.u)())}catch(e){Object(Oe.k)({data:[e],type:"warn"})}},setUserJwt:function setUserJwt(e){try{i.a.dispatch(Object(pe.m)(e))}catch(t){Object(Oe.k)({data:[t],type:"warn"})}}},nn=new Tt,an=function handleApiEvent(e){var t=e.data,n=t.method,a=t.args;tn[n]?Ft(n,a)&&nn.execute(function(){return Object(At.c)("API Event Fired",{method:n}),tn[n].apply(tn,Object(ae.a)(a))}):Nt("".concat(n,"(...) does not exist."))},rn=n("efbE"),cn=n("m6rJ"),on=function widgetBootstrap(e,t){var n=Object(cn.e)(e);return rn.c.post("widget_bootstrap",{data:Object(d.a)(Object(d.a)({},n),t)})},sn=function getEmbedConfiguration(e){return rn.n.get("/embeds/".concat(e,".json"))},un=n("vEWT"),ln=["BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE","GB"],dn=["CA"],fn={EU:ln,CANADA:dn,EU_CANADA:[].concat(dn,ln),NONE:"NONE",ALL:"ALL"},pn={googleAnalyticsSettings:!0},bn=n("yKvL"),hn=n("6BAR"),vn=n("qixE"),gn=n("CYoe"),On=n("z8Kx"),jn=n("LvsC"),mn=n("qytN"),kn=n("7jL2"),_n=it.a.get,yn=function(){var e=Object(c.a)(r.a.mark(function _callee(){var e,t,n,a,c,o;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return e=i.a.getState(),t=e.session,n=e.conversations,r.next=3,_n("visitCounts");case 3:return a=r.sent,c=a.data,o=Object(f.a)(["href"],t.context.page),r.abrupt("return",{engagement:{activeConversation:n.endUserEngaged},page:o,location:Cn(t.geo),session:wn(t.context,c)});case 7:case"end":return r.stop()}},_callee)}));return function generatePresenceContext(){return e.apply(this,arguments)}}(),wn=function _hydrateSessionPresenceData(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{numPageViews:Object(j.a)(0,["total"],t),numSessions:Object(j.a)(0,["total"],t),currentSessionStartedAt:e.currentSessionStartedAt,currentPageViewStartedAt:e.currentPageViewStartedAt,previousSessionStartedAt:Object(j.a)(null,["lastVisit"],t),previousSessionEndedAt:null,firstSessionAt:Object(j.a)(null,["firstVisit"],t),activeSessionStartedAt:e.activeSessionStartedAt}},Cn=function _hydrateGeoPresenceData(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(Ie.a)(e)?{}:{ip:e.ip,city:e.city,subdivision:e.subdivision,country:e.country,countryCode:e.countryCode,gdprApplicable:e.gdprApplicable,metroCode:e.metroCode,postalCode:e.postalCode,latLong:{lat:e.latitude,lon:e.longitude}}},En=n("7VeV"),xn=n("LeJ0"),In=n("Gzp1"),Sn=n("l+Xe"),Tn=function OpenSocket(e){var t=e.session_token,n=e.org_id,a=e.socketCluster,r=e.ip,c=xn.a.WS_PROTOCOL,o="LOCAL"===xn.a.WS_USER_ENV?"":"".concat(n,"-"),i=Mn(n,o,a),s="".concat(c,"://").concat(i,"/ws"),u=new In.Socket(s,{params:{session_token:t,remote_ip:r},timeout:1e4,reconnectAfterMs:function reconnectAfterMs(e){return[1e3,2e3,5e3,1e4][e-1]||1e4},rejoinAfterMs:function rejoinAfterMs(e){return[1e3,2e3,5e3][e-1]||1e4}});return u.connect(),u.onError(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Object(Oe.k)({data:["Failed to connect to socket: ".concat(s)].concat(t)})}),u.onClose(function(){return Object(Oe.k)({data:["socket ".concat(s," has closed")]})}),u},An=function(){var e=Object(c.a)(r.a.mark(function _callee2(e){var t,n,a,o;return r.a.wrap(function _callee2$(i){for(;;)switch(i.prev=i.next){case 0:return t=e.channelName,n=e.socket,a=e.events,o=new Promise(function(){var e=Object(c.a)(r.a.mark(function _callee(e,c){var o;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:o=n.channel(t),a.forEach(function(e){var t=e.topic,n=e.event;o.on(t,n)}),o.join().receive("ok",function(){e({channel:o})}).receive("error",function(e){Object(Oe.k)({data:["Error connecting to channel: ".concat(t)]}),c(e)}).receive("timeout",function(e){Object(Oe.k)({data:["Joining the ".concat(t," channel timed out. ")]})});case 3:case"end":return r.stop()}},_callee)}));return function(t,n){return e.apply(this,arguments)}}()),i.abrupt("return",o);case 3:case"end":return i.stop()}},_callee2)}));return function JoinChannel(t){return e.apply(this,arguments)}}(),Mn=function _resolveSocketBaseForType(e,t,n){switch(n){case Qn.CHAT:return"".concat(Object(Sn.d)(e));case Qn.USER:return xn.a.WS_USER_BASE;case Qn.PRESENCE:return"".concat(t).concat(Object(Sn.c)(e));case Qn.VISITOR_PRESENCE:return xn.a.WS_VISITOR_PRESENCE_BASE;default:return""}},Rn="emailCapture",Pn=/(?:(?:\+?1\s*(?:[.-]\s*)?)?(?:\(\s*([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9])\s*\)|([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9]))\s*(?:[.-]\s*)?)?([2-9]1[02-9]|[2-9][02-9]1|[2-9][02-9]{2})\s*(?:[.-]\s*)?([0-9]{4})(?:\s*(?:#|x\.?|ext\.?|extension)\s*(\d+))?/gim,Nn=n("7BJg");function _createSuper2(e){return function(){var t,n=Object(kn.a)(e);if(function isNativeReflectConstruct(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()){var a=Object(kn.a)(this).constructor;t=Reflect.construct(n,arguments,a)}else t=n.apply(this,arguments);return Object(mn.a)(this,t)}}var Dn=1e3,Ln=new(function(e){Object(jn.a)(AgentMessageEventBuffer,e);var t=_createSuper2(AgentMessageEventBuffer);function AgentMessageEventBuffer(){var e;return Object(It.a)(this,AgentMessageEventBuffer),(e=t.call(this,Dn))._publishBuffer=function(){e._events.length&&(Object(C.k)(e._events).forEach(function(t){e._dispatchAgentMessage(t),Object(C.e)(t,"startInteraction")&&!Object(C.e)(t,"campaignId")?(e._openChatWithMessage(t),e._setMessageReadStatus(t,!0)):e._setMessageReadStatus(t)}),e._resetBuffer())},e._openChatWithMessage=function(e){i.a.getState().view.chatOpen||setTimeout(function(){return i.a.dispatch(Object(P.a)({chatOpen:!0}))},500)},e._setMessageReadStatus=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]?Object(re.g)(e.conversationId,[e.id]):i.a.dispatch(Object(ie.s)({message:e}))},e._dispatchAgentMessage=function(e){i.a.dispatch(Object(ie.c)({message:e}))},e}return AgentMessageEventBuffer}(Nn.a)),Un=function evaluateEndUserResponseChatMessage(e){if(Object(C.e)(e,"buttonClicked")&&Object(A.b)(e),e.body){var t=function extractPhoneNumbers(e){return e?e.match(Pn):null}(e.body);t&&t.length&&t.forEach(function(t){Object(A.n)(e,t)})}},Bn=function evaluateBotChatMessage(e){if(Object(C.e)(e,"offerSchedule")||Object(C.e)(e,"presentSchedule")){var t=e.attributes.offerSchedule;Object(A.j)(t),Object(fe.d)(Ge.c.CALENDAR_DROP)}},Vn=n("BMKr"),Fn=function(){var e=Object(c.a)(r.a.mark(function _callee(e){var t,n,a;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return t=Object(j.a)([],["attributes","conditionSetsToEvaluate"],e),r.next=3,ut(t);case 3:n=r.sent,a={requestingMessageId:e.id,conversationId:e.conversationId,targetingRequestPayload:n};try{Object(be.a)(a)}catch(c){Object(Vn.a)(new Error("Failed to evaluate conditional skill"))}case 6:case"end":return r.stop()}},_callee)}));return function evaluateConditionalMessage(t){return e.apply(this,arguments)}}(),$n=function evaluateNewMessage(e){var t=Object(Ee.a)(["body","data"],e);if(Object(C.e)(t,"widgetGuid"))return Un(t);var n=Object(C.e)(t,"startInteraction"),a=Object(C.e)(t,"liveViewInitiated"),r=Object(C.a)(t,"playbookId"),c=Object(C.a)(t,"interactionId"),o=t.conversationId,s=t.contentType===Te.c.BOT_NODE_CONDITION_EVALUATION&&Object(C.e)(t,"conditionSetsToEvaluate"),u=Object(j.a)(!1,["contentType",Te.c.CHAT],t)&&!t.body.length;return n&&(Object(A.q)(t),Object(M.b)(t),Object(Ce.a)({playbookId:r,interactionId:c,conversationId:o,isVirtual:!1})),a?function evaluateLiveViewMessage(e){var t=e.id,n=void 0===t?null:t,a=e.conversationId,r=void 0===a?null:a;if(r&&n){var c=Object(d.a)(Object(d.a)({},e.attributes),{},{senderId:e.authorId}),o=Object(d.a)(Object(d.a)({},e),{},{attributes:c});i.a.dispatch(Object(ie.a)()),i.a.dispatch(Object(ie.n)({conversationId:r})),i.a.dispatch(Object(ie.c)({message:o}))}}(t):s?Fn(t):Object(C.l)(t)?function evaluateChatMessage(e){var t=e.body.data;if(Ln.push(t),Object(A.l)(t),Object(C.e)(t,"isBot"))return Bn(t)}(e):u?Object(re.g)(t.conversationId,[t.id]):void 0},Hn={topic:"data:sentMessage",event:function event(e){i.a.dispatch(Object(ie.i)(e))}},Gn={topic:"typing:started",event:function event(e){window.fallbackTimeout&&window.clearTimeout(window.fallbackTimeout),i.a.dispatch(Object(ie.q)({conversationId:e.conversationId,userId:e.userId,isTyping:!0})),window.fallbackTimeout=window.setTimeout(function(){i.a.dispatch(Object(ie.q)({conversationId:e.conversationId,userId:e.userId,isTyping:!1}))},5e3)}},Wn={topic:"typing:finished",event:function event(e){i.a.dispatch(Object(ie.q)({conversationId:e.conversationId,isTyping:!1}))}},qn=function(){var e=Object(c.a)(r.a.mark(function _callee(e){return r.a.wrap(function _callee$(t){for(;;)switch(t.prev=t.next){case 0:"CREATE"===e.body.type&&"MESSAGE"===e.body.object.type&&$n(e);case 2:case"end":return t.stop()}},_callee)}));return function onUserChangeEvent(t){return e.apply(this,arguments)}}(),Jn=function(){var e=Object(c.a)(r.a.mark(function _callee2(e){var t,n,a;return r.a.wrap(function _callee2$(r){for(;;)switch(r.prev=r.next){case 0:t=e.body,n=t.type,a=t.data,n===Rn&&i.a.dispatch(Object(pe.c)({email:a.email}));case 2:case"end":return r.stop()}},_callee2)}));return function onUserTriggeredEvent(t){return e.apply(this,arguments)}}(),zn=[Hn],Kn=[Gn,Wn,{topic:"change",event:qn},{topic:"conversationPermaclose",event:function(){var e=Object(c.a)(r.a.mark(function _callee3(e){var t;return r.a.wrap(function _callee3$(n){for(;;)switch(n.prev=n.next){case 0:t=e.conversationId,i.a.dispatch(Object(ie.b)({conversationId:t}));case 2:case"end":return n.stop()}},_callee3)}));return function onUserPermacloseEvent(t){return e.apply(this,arguments)}}()},{topic:"event",event:Jn}],Yn=[],Qn=Object.freeze({CHAT:"chat",USER:"user",PRESENCE:"presence",VISITOR_PRESENCE:"visitor_presence"}),Zn=Object.freeze({CHAT:"chat",USER:"user",ORG_PUBLIC:"live",LIVE:"live"}),Xn=Object.freeze({CHAT:"chat",USER:"user",PRESENCE:"presence"}),ea=function(){var e=Object(c.a)(r.a.mark(function _callee2(e){var t,n,a,o,i;return r.a.wrap(function _callee2$(s){for(;;)switch(s.prev=s.next){case 0:return t=e.session_token,n=e.org_id,a=e.socketCluster,o=e.ip,i=new Promise(function(){var e=Object(c.a)(r.a.mark(function _callee(e,c){var i;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Tn({session_token:t,org_id:n,socketCluster:a,ip:o});case 2:if(!(i=r.sent)){r.next=7;break}return r.abrupt("return",e(i));case 7:return r.abrupt("return",c("could not connect"));case 8:case"end":return r.stop()}},_callee)}));return function(t,n){return e.apply(this,arguments)}}()),s.abrupt("return",i);case 3:case"end":return s.stop()}},_callee2)}));return function connectToSocket(t){return e.apply(this,arguments)}}(),ta=function(){var e=Object(c.a)(r.a.mark(function _callee3(e){var t,n,a,c,o,i;return r.a.wrap(function _callee3$(r){for(;;)switch(r.prev=r.next){case 0:return t=e.socket,n=e.socketAuth,a=e.channelEvents,c=e.channelName,o=e.orgId,r.prev=1,r.next=4,An({channelName:na(c,n.user_id,o),socket:t,events:aa(a)});case 4:return i=r.sent,r.abrupt("return",i);case 8:r.prev=8,r.t0=r.catch(1),Object(Oe.e)(new Error(r.t0));case 11:case"end":return r.stop()}},_callee3,null,[[1,8]])}));return function connectToChannel(t){return e.apply(this,arguments)}}(),na=function _resolveChannelName(e,t,n){switch(e){case Zn.USER:case Zn.CHAT:return"".concat(e,":").concat(t);case Zn.LIVE:return"".concat(e,":").concat(n);default:return""}},aa=function _resolveChannelEvents(e){switch(e){case Xn.CHAT:return zn;case Xn.USER:return Kn;case Xn.PRESENCE:return Yn;default:return[]}},ra=6e4,ca=function(){function SocketManager(){Object(It.a)(this,SocketManager),this._fireChannelConnectedEvent=function(e,t,n){i.a.dispatch(Object(pe.f)(Object(d.a)({key:e,cluster:t},n)))}}return Object(St.a)(SocketManager,[{key:"_fireSocketConnectedEvent",value:function _fireSocketConnectedEvent(e){i.a.dispatch(Object(pe.r)({cluster:e}))}}]),SocketManager}();function chat_createSuper2(e){return function(){var t,n=Object(kn.a)(e);if(function isNativeReflectConstruct(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()){var a=Object(kn.a)(this).constructor;t=Reflect.construct(n,arguments,a)}else t=n.apply(this,arguments);return Object(mn.a)(this,t)}}var oa=new(function(e){Object(jn.a)(ChatSocketManager,e);var t=chat_createSuper2(ChatSocketManager);function ChatSocketManager(){var e;return Object(It.a)(this,ChatSocketManager),(e=t.call(this))._heartbeatInterval=void 0,e._socket=void 0,e._channel=void 0,e._sendPresencePing=Object(c.a)(r.a.mark(function _callee(){var t,n;return r.a.wrap(function _callee$(a){for(;;)switch(a.prev=a.next){case 0:if(e._channel){a.next=2;break}return a.abrupt("return");case 2:return a.next=4,yn();case 4:t=a.sent,n=t.page,e._channel.channel.push("presence:send_update",{page:n});case 7:case"end":return a.stop()}},_callee)})),e.throttledPresencePing=Object(En.throttle)(ra,!1,e._sendPresencePing),e._socket=null,e._channel=null,e._heartbeatInterval=null,e}return Object(St.a)(ChatSocketManager,[{key:"connect",value:function(){var e=Object(c.a)(r.a.mark(function _callee2(e){var t,n,a,c=this;return r.a.wrap(function _callee2$(r){for(;;)switch(r.prev=r.next){case 0:return t=e.accessToken,n=e.orgId,Object(cn.f)(n),r.next=4,Object(On.a)({fn:cn.b,socketCluster:Qn.CHAT,token:t});case 4:return a=r.sent,r.next=7,ea({ip:a.remote_ip,org_id:n,session_token:a.session_token,socketCluster:Qn.CHAT});case 7:return this._socket=r.sent,this._fireSocketConnectedEvent(Qn.CHAT),r.next=11,ta({socket:this._socket,channelEvents:Xn.USER,channelName:Zn.USER,orgId:n,socketAuth:a});case 11:this._channel=r.sent,this._fireChannelConnectedEvent("user",Qn.CHAT,this._channel),this._channel&&(this._sendPresencePing(),this._channel.channel.on("presence:request_update",function(){c.throttledPresencePing()}));case 14:case"end":return r.stop()}},_callee2,this)}));return function connect(t){return e.apply(this,arguments)}}()}]),ChatSocketManager}(ca)),ia=n("4+fu");function user_createSuper2(e){return function(){var t,n=Object(kn.a)(e);if(function isNativeReflectConstruct(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()){var a=Object(kn.a)(this).constructor;t=Reflect.construct(n,arguments,a)}else t=n.apply(this,arguments);return Object(mn.a)(this,t)}}new(function(e){Object(jn.a)(UserSocketManager,e);var t=user_createSuper2(UserSocketManager);function UserSocketManager(){var e;return Object(It.a)(this,UserSocketManager),(e=t.call(this))._heartbeatInterval=void 0,e._socket=void 0,e._channel=void 0,e.sendMessage=function(t){e._pushMessageToChannel("request:sendMessage",t)},e._pushMessageToChannel=function(t,n){Object(j.a)(!1,["_channel","channel"],Object(ia.a)(e))&&e._channel.channel.push(t,n)},e._socket=null,e._channel=null,e._heartbeatInterval=null,e}return Object(St.a)(UserSocketManager,[{key:"connect",value:function(){var e=Object(c.a)(r.a.mark(function _callee(e){var t,n,a,c;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return t=e.orgId,n=e.accessToken,Object(cn.g)(),r.next=4,Object(cn.c)({access_token:n});case 4:return a=r.sent,c=a.data,r.next=8,ea(Object(d.a)(Object(d.a)({},c),{},{socketCluster:Qn.USER,orgId:t,ip:c.remote_ip}));case 8:return this._socket=r.sent,this._fireSocketConnectedEvent(Qn.USER),r.next=12,ta({socket:this._socket,channelEvents:Xn.CHAT,socketAuth:c,channelName:Zn.CHAT,orgId:t});case 12:this._channel=r.sent,this._fireChannelConnectedEvent("chat",Qn.USER,this._channel),this._pushMessageToChannel("data:conversations");case 15:case"end":return r.stop()}},_callee,this)}));return function connect(t){return e.apply(this,arguments)}}()}]),UserSocketManager}(ca));function visitorPresence_createSuper2(e){return function(){var t,n=Object(kn.a)(e);if(function isNativeReflectConstruct(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()){var a=Object(kn.a)(this).constructor;t=Reflect.construct(n,arguments,a)}else t=n.apply(this,arguments);return Object(mn.a)(this,t)}}var sa=new(function(e){Object(jn.a)(VisitorPresenceSocketManager,e);var t=visitorPresence_createSuper2(VisitorPresenceSocketManager);function VisitorPresenceSocketManager(){var e;return Object(It.a)(this,VisitorPresenceSocketManager),(e=t.call(this))._heartbeatInterval=void 0,e._socket=void 0,e._channel=void 0,e._socket=null,e._channel=null,e._heartbeatInterval=null,e}return Object(St.a)(VisitorPresenceSocketManager,[{key:"connect",value:function(){var e=Object(c.a)(r.a.mark(function _callee(e){var t,n,a;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return t=e.orgId,n=e.accessToken,Object(cn.h)(),r.next=4,Object(On.a)({fn:cn.d,socketCluster:Qn.VISITOR_PRESENCE,token:n});case 4:return a=r.sent,r.next=7,ea({ip:a.remote_ip,org_id:t,session_token:a.session_token,socketCluster:Qn.VISITOR_PRESENCE});case 7:return this._socket=r.sent,this._fireSocketConnectedEvent(Qn.VISITOR_PRESENCE),r.next=11,ta({socket:this._socket,channelEvents:Xn.PRESENCE,channelName:Zn.LIVE,orgId:t,socketAuth:a});case 11:this._channel=r.sent,this._fireChannelConnectedEvent("user",Qn.VISITOR_PRESENCE,this._channel),this._channel&&(this._updatePresence(),this.startPresenceUpdateHeartbeat());case 14:case"end":return r.stop()}},_callee,this)}));return function connect(t){return e.apply(this,arguments)}}()},{key:"startPresenceUpdateHeartbeat",value:function startPresenceUpdateHeartbeat(){this._heartbeatInterval=window.setInterval(this._updatePresence.bind(this),ra)}},{key:"_updatePresence",value:function(){var e=Object(c.a)(r.a.mark(function _callee2(){var e;return r.a.wrap(function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:if(this._channel){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,yn();case 4:e=t.sent,this._channel.channel.push("heartbeat",e);case 6:case"end":return t.stop()}},_callee2,this)}));return function _updatePresence(){return e.apply(this,arguments)}}()},{key:"stopPresenceUpdateHeartbeat",value:function stopPresenceUpdateHeartbeat(){window.clearInterval(this._heartbeatInterval)}}]),VisitorPresenceSocketManager}(ca)),ua=n("H/qh"),la=n("TbSn"),da=n("SWQ0"),fa=n("A5mO"),pa=n("wNJw"),ba=n("VpmR"),ha={isFromConversationalLandingPage:!1},va=function(){var e=Object(c.a)(r.a.mark(function _callee(e){var t,n,a,c,o,s;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:if(t=Object(j.a)({},["embed","configuration"],i.a.getState()),n=t.interactionSlugMap,a=void 0===n?{}:n,c=t.interactionTestingSlugMap,o=void 0===c?{}:c,s=e?e.substring(1):null){r.next=4;break}return r.abrupt("return",!1);case 4:if(!o[s]){r.next=8;break}return r.next=7,ga(e,o[s],Object(d.a)(Object(d.a)({},ha),{},{isTestingConversation:!0}));case 7:return r.abrupt("return",!0);case 8:if(!a[s]){r.next=12;break}return r.next=11,ga(e,a[s],ha);case 11:return r.abrupt("return",!0);case 12:return r.abrupt("return",!1);case 13:case"end":return r.stop()}},_callee)}));return function fireByDriftlink(t){return e.apply(this,arguments)}}(),ga=function(){var e=Object(c.a)(r.a.mark(function _callee2(e,t,n){var a;return r.a.wrap(function _callee2$(r){for(;;)switch(r.prev=r.next){case 0:return a=Object(le.c)(),r.prev=1,i.a.dispatch(Object(ie.o)(e)),i.a.dispatch(Object(ie.p)()),r.next=6,Object(re.a)(t,Object(d.a)(Object(d.a)({},n),{},{locale:a}));case 6:r.next=11;break;case 8:r.prev=8,r.t0=r.catch(1),Object(Oe.k)({data:["Failed to activate drift link ".concat(e,":").concat(t),r.t0]});case 11:case"end":return r.stop()}},_callee2,null,[[1,8]])}));return function activateDriftLink(t,n,a){return e.apply(this,arguments)}}(),Oa=n("HSQL"),ja=it.a.get,ma=it.a.set;function Bootstrap(e){var t=e.embedId,n=e.params;return this.dispatch=i.a.dispatch,this.state=i.a.getState,this.embedId=t,this.params=n,this}Bootstrap.prototype.dataProtection=Object(c.a)(r.a.mark(function _callee(){var e,t,n,a,c,o,i,s,u,l;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:if(e=this.state(),t=e.embed,n=e.session,a=n.gdpr,c=n.geo,o=c.country,i=t.configuration.dataProtection,s=function resolveNeedsConsent(e){return"ALL"===e||!("NONE"===e||!e)&&(!o||Object(ua.a)(o,fn[e]))},i){r.next=7;break}return r.abrupt("return",this.dispatch(Object(pe.n)({needsConsent:!1,hasConsent:!0})));case 7:u=s(i.targeting),l=!u||a.hasConsent,this.dispatch(Object(pe.n)({needsConsent:u,hasConsent:l}));case 10:case"end":return r.stop()}},_callee,this)})),Bootstrap.prototype.handleDriftLinks=Object(c.a)(r.a.mark(function _callee2(){var e;return r.a.wrap(function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.params.skipCampaigns,t.t0=!e,!t.t0){t.next=5;break}return t.next=5,this.hasDriftLinkFire();case 5:case"end":return t.stop()}},_callee2,this)})),Bootstrap.prototype.hydrateContext=Object(c.a)(r.a.mark(function _callee3(){var e;return r.a.wrap(function _callee3$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(Et.b)();case 2:return e=t.sent,this.dispatch(Object(pe.h)(e)),t.abrupt("return",e);case 5:case"end":return t.stop()}},_callee3,this)})),Bootstrap.prototype.sendPageTrackEvent=function(e){Object(ce.a)("Page",e.page)},Bootstrap.prototype.countVisit=Object(c.a)(r.a.mark(function _callee4(){var e,t,n,a,c,o,i;return r.a.wrap(function _callee4$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(u.a)({topic:"access-host-window",message:{key:"location"}});case 2:return e=r.sent,t=e.data,n=void 0===t?{}:t,r.next=7,ja("visitCounts");case 7:a=r.sent,c=a.data,o=c||{},i=Object(hn.a)(o,function(e){e.total=(e.total||0)+1,e.daysSinceLastVisit=fa.a.now().since(e.lastVisit||fa.a.now()).diff.days,e.lastVisit=fa.a.now().epoch,e.firstVisit=e.firstVisit||fa.a.now().epoch,e[n.pathname]=(e[n.pathname]||0)+1}),ma("visitCounts",i);case 12:case"end":return r.stop()}},_callee4)})),Bootstrap.prototype.fetchPreRequisiteData=Object(c.a)(r.a.mark(function _callee6(){var e,t,n,a,o,s,u;return r.a.wrap(function _callee6$(l){for(;;)switch(l.prev=l.next){case 0:return e={},this.dispatch(Object(pe.q)({session:this.params.session})),l.prev=2,l.next=5,sn(this.embedId);case 5:t=l.sent,n=t.data,a=t.responseTime,o=void 0===a?0:a,e=n,this.dispatch(ue(e)),Object(At.d)("Bootstrap.embed_fetch",o),l.next=17;break;case 14:l.prev=14,l.t0=l.catch(2),Object(Oe.e)(new bn.a("Embed Failed to load correctly - ".concat(l.t0.message)),l.t0);case 17:try{(s=Object(xt.f)(Object(j.a)(null,["configuration","theme","cookieDomains"],e)))&&i.a.dispatch(Object(pe.i)({cookieDomain:s}))}catch(d){Object(Oe.e)(new bn.a("Failed to set custom cookie domain - ".concat(d.message)),d)}return u=function(){var t=Object(c.a)(r.a.mark(function _callee5(){var t;return r.a.wrap(function _callee5$(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,t=Object(j.a)("en",["configuration","locale"],e),n.next=4,Object(ba.a)(t);case 4:n.next=9;break;case 6:n.prev=6,n.t0=n.catch(0),Object(Oe.k)({data:["i18n failed to load - ".concat(n.t0.message),n.t0],type:"warn"});case 9:case"end":return n.stop()}},_callee5,null,[[0,6]])}));return function setupI18n(){return t.apply(this,arguments)}}(),l.next=21,u();case 21:case"end":return l.stop()}},_callee6,this,[[2,14]])})),Bootstrap.prototype.handleAuthentication=Object(c.a)(r.a.mark(function _callee8(){var e,t,n,a;return r.a.wrap(function _callee8$(o){for(;;)switch(o.prev=o.next){case 0:return e=this.state().embed.orgId,t=null,o.prev=2,o.next=5,Object(Oa.c)(Object(c.a)(r.a.mark(function _callee7(){return r.a.wrap(function _callee7$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(de.a)({orgId:e});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},_callee7)})),"widget_core:identity");case 5:n=o.sent,a=n.result,t=a,o.next=13;break;case 10:o.prev=10,o.t0=o.catch(2),Object(Oe.e)(new bn.a("Failed to authenticate end user"),o.t0);case 13:if(t){o.next=15;break}return o.abrupt("return");case 15:return this.dispatch(Object(pe.j)({endUser:t.endUser})),this.dispatch(Object(pe.e)(t)),this.dispatch(Object(pe.n)({hasConsent:t.didConsentToRequestedConsentId||!1})),o.next=20,this.handleSockets({orgId:e,accessToken:t.accessToken});case 20:case"end":return o.stop()}},_callee8,this,[[2,10]])})),Bootstrap.prototype.handleBootstrap=Object(c.a)(r.a.mark(function _callee10(){var e,t,n,a,o,u,l,d,p,b,h,v,g,O,m,k,_,y,w,C,I,S,T=this;return r.a.wrap(function _callee10$(A){for(;;)switch(A.prev=A.next){case 0:return e=this.state(),t=e.embed,n=e.session,a=Object(j.a)("",["context","page","href"],n),o=n.campaignRefreshToken,u=t.orgId,l=null,d=null,p=null,A.prev=7,A.next=10,Object(de.b)();case 10:return b=A.sent,A.next=13,Object(Oa.c)(Object(c.a)(r.a.mark(function _callee9(){return r.a.wrap(function _callee9$(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,wa({orgId:u,embedId:T.embedId,sessionId:o,identifierMap:b,pageUrl:a});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},_callee9)})),"widget_core:bootstrap_api");case 13:h=A.sent,v=h.result,l=v.tokenResult,g=v.chatAuth||null,O=v.presenceAuth||null,d=v.widgetChatBootstrapResponse,this.dispatch(Object(pe.o)(v.location)),g&&this.dispatch(Object(pe.g)(g)),O&&this.dispatch(Object(pe.p)(O)),d&&(Object(M.c)(d.campaignConversations),(m=Object.keys(d.campaignEnrollment)).length&&this.dispatch(Object(s.d)(m)),d.conversations.length&&this.dispatch(Object(ie.f)({conversations:d.conversations}))),p=v.evaluatedConditionsResults,A.next=29;break;case 26:A.prev=26,A.t0=A.catch(7),Object(Oe.e)(new bn.a("Failed Bootstrap API response - ".concat(A.t0.message)),A.t0);case 29:if(l){A.next=31;break}return A.abrupt("return");case 31:return _=(k=l).accessToken,y=k.didConsentToRequestedConsentId,w=k.assignedAgentId,C=Object(f.a)(["didConsentToRequestedConsentId","accessToken","assignedAgentId"],l),this.dispatch(Object(pe.j)({endUser:C,assignedAgentId:w})),this.dispatch(Object(pe.e)({accessToken:_})),this.dispatch(Object(pe.n)({hasConsent:y||!1})),A.next=38,this.handleSockets({orgId:u,accessToken:_});case 38:if(d){A.next=40;break}return A.abrupt("return");case 40:(I=Object(vn.b)(d.conversations,n))&&this.dispatch(Object(ie.n)({conversationId:I.conversation.id})),S=Object(M.e)(d.campaignConversations),kt({evaluatedConditionsResults:p,onDidNotMatch:function onDidNotMatch(){Object(E.a)(d.conversations)||i.a.dispatch(Object(ie.h)({conversation:Object(la.a)(Object(x.a)(d.conversations))}))},unreadCampaignIds:S,skipCampaignTargeting:!!I});case 44:case"end":return A.stop()}},_callee10,this,[[7,26]])})),Bootstrap.prototype.handleSockets=function(){var e=Object(c.a)(r.a.mark(function _callee11(e){var t,n;return r.a.wrap(function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:return t=e.orgId,n=e.accessToken,a.next=3,Object(Oa.c)(function(){return oa.connect({accessToken:n,orgId:t})},"widget_core.sockets:chat_connect");case 3:case"end":return a.stop()}},_callee11)}));return function(t){return e.apply(this,arguments)}}(),Bootstrap.prototype.hasDriftLinkFire=Object(c.a)(r.a.mark(function _callee12(){var e,t,n,a,c;return r.a.wrap(function _callee12$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(u.a)({topic:"get-host-window"});case 2:return e=r.sent,t=e.data,n=void 0===t?{}:t,a=Object(j.a)("",["location","hash"],n),c=va(a),r.abrupt("return",!c);case 8:case"end":return r.stop()}},_callee12)})),Bootstrap.prototype.connectToPresence=function(){var e=this.state().session.auth.accessToken,t=this.state().embed.orgId;t&&e&&Object(Oa.c)(function(){return sa.connect({accessToken:e,orgId:t})},"widget_core.sockets:visitor_presence_connect")},Bootstrap.prototype.attachIntegrations=Object(c.a)(r.a.mark(function _callee13(){var e,t,n;return r.a.wrap(function _callee13$(a){for(;;)switch(a.prev=a.next){case 0:e=this.state().embed.configuration,t=(void 0===e?{}:e).integrations,n=void 0===t?{}:t,Object.keys(n).forEach(function(e){pn[e]&&Object(u.a)({topic:"handle-host-integration",message:{config:n[e],type:e}})});case 3:case"end":return a.stop()}},_callee13,this)})),Bootstrap.prototype.waitForUserJwt=function(){var e=Object(Oe.h)(function(){console.warn("Drift Widget is still waiting for user JWT!")},3e4);return new Promise(function(t){var n=i.a.subscribe(Object(c.a)(r.a.mark(function _callee14(){return r.a.wrap(function _callee14$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(On.d)();case 2:if(!a.sent){a.next=4;break}return a.abrupt("return");case 4:e(),n(),t();case 7:case"end":return a.stop()}},_callee14)})))})};var ka=function(){var e=Object(c.a)(r.a.mark(function _callee16(e){var t,n,a,o,i,s,u,l,d;return r.a.wrap(function _callee16$(f){for(;;)switch(f.prev=f.next){case 0:return t=new Bootstrap(e),n=Object(j.a)(!1,["params","skipCampaigns"],e),a=Object(j.a)(!1,["params","forceShow"],e),o=Object(j.a)(null,["params","session","sessionId"],e),i=Object(j.a)(null,["params","session","instanceId"],e),t.dispatch(he(n)),t.dispatch(ve(a)),s=function(){var e=Object(c.a)(r.a.mark(function _callee15(){return r.a.wrap(function _callee15$(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(Oa.c)(function(){return t.fetchPreRequisiteData()},"bootstrap: embed");case 3:return e.next=5,Object(On.d)();case 5:if(!e.sent){e.next=8;break}return e.next=8,Object(Oa.c)(function(){return t.waitForUserJwt()},"bootstrap: waitForUserJwt");case 8:return e.next=10,Object(Oa.c)(function(){return t.handleBootstrap()},"bootstrap: bootstrap");case 10:return e.next=12,Object(Oa.c)(function(){return t.dataProtection()},"bootstrap: GDPR");case 12:return _a(),e.next=15,t.handleDriftLinks();case 15:t.dispatch(Object(P.c)({initComplete:!0})),e.next=22;break;case 18:e.prev=18,e.t0=e.catch(0),Object(At.a)("bootstrap.failure"),Object(Oe.e)("Failed to bootstrap - ".concat(e.t0.message),e.t0);case 22:case"end":return e.stop()}},_callee15,null,[[0,18]])}));return function measuredInit(){return e.apply(this,arguments)}}(),f.prev=8,f.next=11,t.countVisit();case 11:return f.next=13,t.hydrateContext();case 13:return u=f.sent,o&&ya(e.embedId,o,i,u),f.next=17,Object(Oa.c)(s,"bootstrap");case 17:l=f.sent,d=l.timing,Object(At.d)("bootstrap",d),t.sendPageTrackEvent(u),t.attachIntegrations(),t.connectToPresence(),Promise.resolve("bootstrap complete"),f.next=30;break;case 26:f.prev=26,f.t0=f.catch(8),Object(Oe.e)(new Error(f.t0)),Promise.reject("bootstrap failed");case 30:case"end":return f.stop()}},_callee16,null,[[8,26]])}));return function init(t){return e.apply(this,arguments)}}(),_a=function(){var e=Object(c.a)(r.a.mark(function _callee17(){var e;return r.a.wrap(function _callee17$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,en();case 2:e=t.sent,Object(pa.a)(da.b.READY,e);case 4:case"end":return t.stop()}},_callee17)}));return function fireWidgetReadyEvent(){return e.apply(this,arguments)}}(),ya=function fireWidgetInitEvent(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r={eventName:"[V2] - init",embedId:e,sessionId:t,instanceId:n,context:{url:Object(Ee.a)(["page","url"],a),hostname:Object(Ee.a)(["page","hostname"],a),timezone:a.timezone,userAgent:a.userAgent}};i.a.dispatch(Object(gn.a)(Date.now())),Object(un.c)(r).catch(function(e){Object(Oe.k)({type:"warn",data:["Failed to send init event"]})})},wa=function(){var e=Object(c.a)(r.a.mark(function _callee18(e){var t,n,a,c,o,i,s,u,l,f;return r.a.wrap(function _callee18$(r){for(;;)switch(r.prev=r.next){case 0:return t=e.orgId,n=e.embedId,a=e.sessionId,c=e.identifierMap,o=e.pageUrl,i={sessionId:a,pageUrl:o,hasHadConversations:!1,followingCampaignIds:[],excludedCampaignIds:[]},s=Object(d.a)(Object(d.a)({},c),{},{embed_id:n,targeting_context:i}),r.next=5,on(t,s);case 5:return u=r.sent,l=u.data,f=u.responseTime,Object(At.d)("enduser_bootstrap",f),r.abrupt("return",l);case 10:case"end":return r.stop()}},_callee18)}));return function callBootstrapApi(t){return e.apply(this,arguments)}}(),Ca=n("JBtm"),Ea=n.n(Ca),xa=n("uiOv");n("z8n0");i.a.name="controller";t.default=Object(xa.a)(function WidgetControllerPage(e){var t=e.location,n=Object(m.useState)(!1),a=Object(o.a)(n,2),s=a[0],d=a[1],f=Object(Ae.d)(Ea.a.parse(t.search)),h=Object(Oe.n)();return Object(m.useEffect)(function(){if(s){var e=Object(Oa.b)("widget_core:widget_loaded");e&&(Object(At.d)("loaded",e),Object(At.a)("widget.v2.load",!1));var t=i.a.getState().embed,n=void 0===t?{}:t;return Object(ee.a)(n),void Object(ee.b)(n)}Object(b.a)({name:"controller",syncWith:"chat",store:i.a}),p(),l(),Object(u.c)({topic:"trigger-api-event",handler:an}),Object(u.c)({topic:"get-ready-payload",handler:en}),Object(u.c)({topic:"identity-provided-email",handler:function handler(e){var t=e.data,n=void 0===t?{}:t;i.a.dispatch(Object(pe.k)(n.email))}}),Object(u.c)({topic:"hide-widget-on-ready",handler:function handler(e){e.data,i.a.dispatch(function setShouldSkipWidgetTargeting(e){return Object(se.a)({type:"SET_SHOULD_SKIP_WIDGET_TARGETING",payload:e})}(!0))}}),Object(u.c)({topic:"show-widget-on-ready",handler:function handler(e){e.data,i.a.dispatch(ve(!0))}}),Object(u.c)({topic:"identity-provided-id",handler:function handler(e){var t=e.data,n=void 0===t?{}:t;i.a.dispatch(Object(pe.l)(n.externalId))}}),Object(u.c)({topic:"identity-provided-jwt",handler:function handler(e){var t=e.data,n=void 0===t?{}:t;i.a.dispatch(Object(pe.m)(n.userJwt))}}),Object(u.c)({topic:"host-hash-change",handler:function handler(e){var t=e.data;return va(t.hash)}}),Object(u.c)({topic:"init-ready",handler:function(){var e=Object(c.a)(r.a.mark(function _callee(){return r.a.wrap(function _callee$(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,e.t0=!s,!e.t0){e.next=5;break}return e.next=5,ka({embedId:f.embedId,params:{skipCampaigns:f.skipCampaigns,forceShow:f.forceShow,session:{sessionId:f.sessionId,sessionStarted:f.sessionStarted,campaignRefreshToken:f.campaignRefreshToken,instanceId:h}}});case 5:d(!0),e.next=11;break;case 8:e.prev=8,e.t1=e.catch(0),console.warn(e.t1);case 11:case"end":return e.stop()}},_callee,null,[[0,8]])}));return function handler(){return e.apply(this,arguments)}}()}),Object(pa.a)(da.b.API_READY)},[f.embedId,f.forceShow,f.skipCampaigns,s,f.sessionId,f.sessionStarted,f.campaignRefreshToken,h]),k.a.createElement(I.a,{store:i.a},s&&k.a.createElement(ne,null))})},LwEI:function(e,t,n){"use strict";var a=n("LVcX"),r=n("uDfI"),c=n("vTYT");t.a=function useWidgetAlignment(){return Object(r.c)(function(e){return Object(a.a)(c.a.RIGHT,["embed","configuration","theme","alignment"],e)})}},My8U:function(e,t,n){"use strict";var a=n("nfbA"),r=n("SWQ0"),c=n("wNJw"),o=n("7oto");t.a=function UseStoreSync(e){var t=e.store,n=e.syncWith,i=e.name;return Object(o.c)({topic:"CONDUCTOR:action-from-".concat(n),handler:function handler(e){t.dispatch(Object(a.a)(Object(a.a)({},e.data.action),{},{_foreignDispatch:!0}))}}),Object(c.a)(r.a["".concat(i.toUpperCase(),"_READY")]),t}},NJR1:function(e,t,n){},"ab+K":function(e,t,n){"use strict";var a=n("O94r"),r=n.n(a),c=n("/UYI"),o=n("nQD+"),i=n("LwEI"),s=n("ERkP"),u=n.n(s);n("NJR1");t.a=function MessageCloseButton(e){var t=e.onClick,n=Object(i.a)();return u.a.createElement(o.a,{onClick:t,className:r()("drift-widget-message-close-button","drift-widget-close-button--align-".concat(n)),"aria-label":"close"},u.a.createElement(c.a,{width:8,height:8}))}},g6eD:function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return c}),n.d(t,"c",function(){return o}),n.d(t,"d",function(){return i});var a=n("Cpup"),r=function toggleChat(e){return Object(a.a)({type:"TOGGLE_CHAT",payload:e})},c=function toggleConversationHistory(e){return Object(a.a)({type:"TOGGLE_CONVERSATION_HISTORY",payload:e})},o=function toggleInitComplete(e){return Object(a.a)({type:"INIT_COMPLETE",payload:e})},i=function toggleMatchedWidgetTargeting(e){return Object(a.a)({type:"TOGGLE_WIDGET_TARGETING_MATCHED",payload:e})}},lE29:function(e,t,n){"use strict";var a=n("nfbA"),r=n("F5GS"),c=n("DboL"),o=n("l6A5"),i=n("uDfI"),s={textColor:"353f45",backgroundColor:"0071EB",foregroundColor:"ffffff",widgetBackgroundColor:"0071EB",activeColor:"blue"},u=function resolveBackgroundStyles(e){return{background:"#".concat(e.backgroundColor),color:"#".concat(e.textColor)}},l=function resolveSvgStyles(e){return{fill:"#".concat(e.textColor)}},d=function resolveBorderStyles(e){return{borderColor:"#".concat(e.backgroundColor)}},f=function resolveTextColorStyles(e){return{color:"#".concat(e.foregroundColor)}},p=function resolveInlineImageStyles(e){return{background:"#".concat(e.foregroundColor),border:"4px solid #".concat(e.foregroundColor)}},b=function resolveHeaderTextStyles(e){return{color:"#".concat(e.foregroundColor)}},h=function resolveInlineFileStyles(e){return{color:"#".concat(e.foregroundColor)}},v=function resolveButtonStyles(e){return{color:"#".concat(e.backgroundColor),borderColor:"#".concat(e.backgroundColor),backgroundColor:"#".concat(e.foregroundColor)}},g=function resolveForegroundColors(e){return{backgroundColor:"#".concat(e.backgroundColor),color:"#".concat(e.foregroundColor),border:"1px solid #".concat(e.backgroundColor)}},O=function resolvePrimaryTextColor(e){return{color:"#".concat(e.backgroundColor)}},j=function resolveWidgetBackgroundStyles(e){return{background:"#".concat(e.widgetBackgroundColor)}},m=function resolveWidgetAlphaBackground(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".8";return{background:function convertHex(e){var n=parseInt(e.substring(0,2),16),a=parseInt(e.substring(2,4),16),r=parseInt(e.substring(4,6),16);return"rgba(".concat(n,", ").concat(a,", ").concat(r,", ").concat(t,")")}(e.widgetBackgroundColor)}},k=Object(r.a)(["activeColor","foregroundColor","backgroundColor","textColor","widgetBackgroundColor"]),_=Object(o.a)(function memoIdentity(e){return Object(c.a)(k(e)).join(";")},function(e){var t=Object(a.a)(Object(a.a)({},s),e);return{backgroundStyles:u(t),borderStyles:d(t),svgStyles:l(t),textColorStyles:f(t),buttonStyles:v(t),foregroundStyles:g(t),inlineImageStyles:p(t),widgetBackgroundStyles:j(t),conversationHeaderTextStyles:b(t),inlineFileStyles:h(t),activeColor:t.activeColor,widgetSecondaryColor:"#".concat(t.foregroundColor),widgetBackgroundColor:t.widgetBackgroundColor,widgetBackgroundAlpha:m(t),primaryTextColor:O(t)}});t.a=function useThemeColors(){var e=Object(i.c)(function(e){return e.embed.configuration.theme});return _(e)}},nedb:function(e,t,n){"use strict";var a=n("LVcX"),r=n("uDfI"),c=function activeCampaignSelector(e){return Object(a.a)(null,["campaigns","activeCampaign"],e)};t.a=function useActiveCampaign(){return Object(r.c)(c)}},o3t1:function(e,t,n){"use strict";var a=n("s8DI"),r=n("ERkP"),c=n("0lfv"),o=n("6wvX");t.a=function useOnHover(){var e=Object(o.a)(),t=Object(r.useState)(!1),n=Object(a.a)(t,2),i=n[0],s=n[1];return Object(r.useMemo)(function(){return e?{}:{hoverProps:{onMouseOver:function onMouseOver(){return s(!0)},onMouseOut:function onMouseOut(){return s(!1)},onFocus:c.l,onBlur:c.l},isHovered:i}},[e,i])}},pUpc:function(e,t,n){},qixE:function(e,t,n){"use strict";n.d(t,"a",function(){return p}),n.d(t,"b",function(){return h});var a=n("mj2O"),r=n.n(a),c=n("7SM1"),o=n("OE2q"),i=n("QtlZ"),s=n("PCkZ"),u=n("DboL"),l=n("M7cN"),d=n("6lNa"),f=n("PjZB"),p=function(){var e=Object(c.a)(r.a.mark(function _callee(e){var t,n,a;return r.a.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:if(e.email&&e.conversationId){r.next=2;break}return r.abrupt("return");case 2:return t={conversationId:e.conversationId,type:d.b.LEAD_CAPTURED,email:e.email,leadCapture:{email:e.email,integrations:Object(s.c)(),context:b()}},r.next=5,Object(o.h)(t);case 5:return n=r.sent,a=n.data,r.abrupt("return",a);case 8:case"end":return r.stop()}},_callee)}));return function createLeadCapturedConversationEvent(t){return e.apply(this,arguments)}}(),b=function hydrateConversationEventContext(){var e=i.a.getState().session,t=(void 0===e?{}:e).context||{},n=t.userAgent,a=t.locale,r=t.timezone,c=t.page;return{page:void 0===c?{}:c,locale:a,timezone:r,userAgent:n}},h=function getUnreadMostRecentConversation(e,t){var n=t.sessionStarted,a=parseInt(n),r=Object(u.a)(e).filter(function(e){return v(e,a)});return r.length?Object(l.a)(function(e){return e.lastMessage.createdAt},r)[0]:null},v=function isUnreadRecentConversation(e,t){return!!e.lastMessage&&null!==e.lastReadMessage&&e.lastMessage.viewerRecipientStatus!==f.f.READ&&e.conversation.type===d.c.CHAT&&e.lastMessage.authorType===f.b.USER&&e.lastMessage.createdAt>=1e3*t}},rAhV:function(e,t,n){"use strict";var a=n("OE2q"),r=n("K7i0"),c=n("bYXQ"),o=n("uDfI"),i=n("0lfv");t.a=function useMarkAsRead(){var e=Object(o.c)(function(e){return e.conversations}).unreadAgentMessages,t=void 0===e?{}:e,n=Object(o.b)();return{markAsRead:function markAsRead(e){var o=t[e]||[];if(o.length)try{Object(c.c)(e)||Object(a.g)(e,o),n(Object(r.l)({conversationId:e}))}catch(s){Object(i.e)(new Error(s))}}}}},tLIi:function(e,t,n){"use strict";var a=n("da4L"),r=n("LVcX"),c=n("i9gz"),o=n("TbSn"),i=n("uDfI");t.a=function useLastAgentMessage(){var e=Object(i.c)(function(e){return e.conversations}).activeConversation,t=Object(i.c)(function(t){return Object(r.a)(null,["conversations","conversations",e,"lastAgentMessage"],t)}),n=Object(i.c)(function(t){var n=Object(r.a)({},["conversations","messages",e],t);if(Object(c.a)(n))return{};var i=Object(a.m)(n).filter(function(e){return"USER"===Object(r.a)(null,["authorType"],e)});return i.length?Object(o.a)(i):void 0});return t||n||{}}},y0on:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var a=n("0lfv"),r=function getNewMessageAriaLabel(e,t){return Object(a.j)(t)?null:"Chat message".concat(e?" from "+e:"",': "').concat(t,'"')}},z8n0:function(e,t,n){}}]);